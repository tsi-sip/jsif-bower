"use strict";angular.module("base.jsif",[]),function(){function loadScript(url,callback){var script=document.createElement("script");script.type="text/javascript";var scriptState=script.readyState;scriptState?script.onreadystatechange=function(){"loaded"!==scriptState&&"complete"!==scriptState||(script.onreadystatechange=null,callback())}:script.onload=function(){callback()},script.src=url,document.getElementsByTagName("head")[0].appendChild(script)}var PROTOCOL=window.location.protocol+"//",HOSTNAME=window.location.hostname,PORT=window.location.port?":"+window.location.port:"";window.moment||loadScript("https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js",function(){}),angular.module("base.jsif").constant("VERSION","1.57.0").constant("USE_CURRENT_HOST",!0).constant("BASE_API_ABSOLUTE_CONFIG_URL",PROTOCOL+HOSTNAME+PORT+"/rest/v1/cf").constant("BASE_API_ABSOLUTE_RETAILER_URL",PROTOCOL+HOSTNAME+PORT+"/rest/v1/retailer").constant("BASE_API_ABSOLUTE_SESSION_URL",PROTOCOL+HOSTNAME+PORT+"/rest/v1/session").constant("BASE_API_PDF_EXPORT_URL","/rest/v1/export").constant("BASE_API_GEO_SUGGEST_URL","/rest/v1/geosuggest").constant("BASE_API_MASTERDATA_URL","/api/md/v2").constant("BASE_API_PROP_SUGGEST_URL","/rest/v1/ps").constant("BASE_API_SEARCHAGENT_URL","/rest/v1/searchagent").constant("BASE_API_SEARCHAGENT_BATCH_URL","/rest/v1/sab").constant("BASE_API_TDVS_URL","/api/tdvs/v1").constant("BASE_API_VMD_URL","/rest/v1/vmd").constant("BASE_API_VEHICLESEARCH_URL","/api/vs/v2").constant("HTTP_CONFIG",{timeout:12e3}).constant("DEBUG",!1).constant("EMULATE_PAINTTYPE_CODETEXT_FACET",!1).constant("IS_TESTING",!1)}(),angular.module("base.jsif").factory("ConfigService",["HttpService","UtilsService","USE_CURRENT_HOST","BASE_API_ABSOLUTE_CONFIG_URL","BASE_API_ABSOLUTE_RETAILER_URL","BASE_API_ABSOLUTE_SESSION_URL",function(HttpService,UtilsService,USE_CURRENT_HOST,BASE_API_ABSOLUTE_CONFIG_URL,BASE_API_ABSOLUTE_RETAILER_URL,BASE_API_ABSOLUTE_SESSION_URL){var CONFIG_BASE_API_HOST_OVERRIDE="jsif.base.api.host.override",lastBaseStatus={},config={},uiConfig={},retailerUiConfig={};return{getConfig:function(){var url={resource:BASE_API_ABSOLUTE_CONFIG_URL};return HttpService.get(url).then(function(response){return response.results&&(uiConfig=response.results.ui,delete response.results.ui,Object.keys(config).length||(config=response.results),delete response.results,response.sections=uiConfig,response._version=response.version,delete response.version),lastBaseStatus=response.baseStatus,UtilsService.log("CONFIG RESPONSE:\n %s",response),UtilsService.log("INTERNAL CONFIG:\n %s",config),response})},getConfigSync:function(){var url={resource:BASE_API_ABSOLUTE_CONFIG_URL},response=HttpService.getSync(url,!0);return response.results&&(uiConfig=response.results.ui,Object.keys(config).length||(config=response.results),response.sections=uiConfig,response._version=response.version,delete response.results,delete response.version,delete response.uiInfo),lastBaseStatus=response.baseStatus,UtilsService.log("CONFIG RESPONSE (SYNC.):\n %s",response),UtilsService.log("INTERNAL CONFIG:\n %s",config),response},getRetailerConfigSync:function(){var url={resource:BASE_API_ABSOLUTE_RETAILER_URL},response=HttpService.getSync(url,!0);return response.uiInfo&&(retailerUiConfig=response.uiInfo),response._version=response.version,delete response.sections,delete response.uiInfo,delete response.version,response},getInternalConfig:function(key){return config[key]?config[key]:""},getLastBaseStatus:function(){return lastBaseStatus},getCurrentYear:function(){return HttpService.getCurrentYear()},getUIFields:function(){var result=uiConfig.fields||{};return result},getUIConfigs:function(){var result={base:uiConfig,retailer:retailerUiConfig};return result},emptyConfigCache:function(){var emptyObject={};angular.copy(emptyObject,config),angular.copy(emptyObject,uiConfig),angular.copy(emptyObject,retailerUiConfig)},getSessionRequest:function(sessionId){var url={fullUrl:BASE_API_ABSOLUTE_SESSION_URL+"/id/"+sessionId};return HttpService.get(url).then(function(response){return response.sessionResponse})},getBaseApiURL:function(relativeUrl){var CURRENT_HOST=HttpService.computeHost(),host=CURRENT_HOST;if(!USE_CURRENT_HOST){var overrideHost=this.getInternalConfig(CONFIG_BASE_API_HOST_OVERRIDE);overrideHost&&(host=overrideHost)}0!==relativeUrl.indexOf("/")&&(relativeUrl="/"+relativeUrl);var result=host+relativeUrl;return result}}}]),angular.module("base.jsif").factory("ContextService",[function(){var context={};return{getContext:function(){return context},setContext:function(newContext){context=newContext}}}]),angular.module("base.jsif").factory("EMBWrapperService",["HttpService","ConfigService","ContextService","UtilsService",function(HttpService,ConfigService,ContextService,UtilsService){var lastBaseStatus={code:200,text:"OK"},CONFIG_BASE_BASE_URL="base.base.url",CONFIG_UI_PATH_DEALERSNIPPET="ui.path.dealersnippet",CONFIG_UI_PATH_CMS="ui.path.cms";return{performRQ:function(rqParameter){return HttpService.post({resource:"/rq"}).then(function(response){return lastBaseStatus=response.baseStatus,response.data})},performDL:function(dlParameter){return HttpService.post({resource:"/dl",filename:"dl"}).then(function(response){return lastBaseStatus=response.baseStatus,response.data})},performKDV:function(kdvParameter){return HttpService.get({resource:"/kdv",filename:"kdv"}).then(function(response){return lastBaseStatus=response.baseStatus,response.data})},getCMSContent:function(name){UtilsService.log("GET CMS CONTENT REQUEST PARAM.:\n %s",name);var context=ContextService.getContext(),root="",cmsPath=ConfigService.getInternalConfig(CONFIG_UI_PATH_CMS);if(0===cmsPath.indexOf("http")||0===cmsPath.indexOf("./"))root=cmsPath;else{var configURLEntry=ConfigService.getInternalConfig(CONFIG_BASE_BASE_URL),baseURL=HttpService.buildURLFromConfig(configURLEntry);root=baseURL+cmsPath}var fullUrl=root+"cmsResponse_"+context.processId+"_"+context.countryCode+"_"+context.language+"_"+name+".json";return HttpService.get({fullUrl:fullUrl,contentIsJson:!0},null,"arraybuffer").then(function(response){return UtilsService.log("GET CMS CONTENT RESPONSE:\n%s",response),response})},getDealerSnippet:function(){var context=ContextService.getContext(),root=ConfigService.getInternalConfig(CONFIG_UI_PATH_DEALERSNIPPET),localPath=root+"dealeraddress_"+context.processId+"_"+context.countryCode+"_"+context.language+".html";return HttpService.get({localPath:localPath},null,"arraybuffer").then(function(response){return UtilsService.log("GET DEALER SNIPPET RESPONSE:\n %s",response),response})},getLastBaseStatus:function(){return lastBaseStatus}}}]),angular.module("base.jsif").factory("ExportService",["HttpService","ConfigService","UtilsService","BASE_API_PDF_EXPORT_URL",function(HttpService,ConfigService,UtilsService,BASE_API_PDF_EXPORT_URL){var lastBaseStatus={};return{getPdf:function(vehicleFom){UtilsService.log("GET PDF EXPORT REQUEST:\n %s",vehicleFom),vehicleFom.vehicle&&(vehicleFom=vehicleFom.vehicle);var postData={vehicleFom:vehicleFom},financialDigest=UtilsService.hashCode(JSON.stringify(vehicleFom.financings)),url=ConfigService.getBaseApiURL(BASE_API_PDF_EXPORT_URL);return HttpService.post({resource:url,vehicleId:vehicleFom.id,financialDigest:financialDigest},postData,"arraybuffer").then(function(response){return lastBaseStatus=response.byteLength>0?{code:"200",text:"OK"}:response.baseStatus,UtilsService.log("PDF EXPORT RESPONSE:\n %s",response),response})},triggerPdfDownload:function(vehicleFom){UtilsService.log("GET PDF EXPORT REQUEST:\n %s",vehicleFom),vehicleFom.vehicle&&(vehicleFom=vehicleFom.vehicle);var postData={vehicleFom:vehicleFom},financings=vehicleFom.financings||{},financialDigest=UtilsService.hashCode(JSON.stringify(financings)),url=ConfigService.getBaseApiURL(BASE_API_PDF_EXPORT_URL);HttpService.submitForm({resource:url,vehicleId:vehicleFom.id,financialDigest:financialDigest},postData)},getLastBaseStatus:function(){return lastBaseStatus}}}]),angular.module("base.jsif").factory("FOMMapperService",["FOMRulesService","ConfigService","ContextService",function(FOMRulesService,ConfigService,ContextService){function updateFormattedDealerInformation(BOM){var formatted={};return formatted.nameline1=BOM.nameline1,formatted.nameline2=BOM.nameline2,formatted.nameline3=BOM.nameline3,formatted.addressLine1=BOM.addressLine1,formatted.addressLine2=BOM.addressLine2,formatted.addressLine3=BOM.addressLine3,formatted.cityZipcodeLine=BOM.cityZipcodeLine,formatted.cityAddon1Line=BOM.cityAddon1Line,formatted.cityAddon2Line=BOM.cityAddon2Line,formatted.contextSpecificEmail=BOM.contextSpecificEmail,formatted.contextSpecificFax=BOM.contextSpecificFax,formatted.contextSpecificPhone=BOM.contextSpecificPhone,formatted.phoneLine=BOM.phoneLine,formatted.faxLine=BOM.faxLine,formatted.email=BOM.email,formatted.contactImageURL=BOM.contactImageURL,formatted.contactNameLine=BOM.contactNameLine,formatted.callbackActivated=BOM.callbackActivated,formatted.links=BOM.links,angular.equals({},formatted)&&(formatted=void 0),formatted}function updateDealerInformation(BOM,dealerInfo){return dealerInfo.city=BOM.city,dealerInfo.addressAddition=BOM.addressAddition,dealerInfo.addressLine1=BOM.street,dealerInfo.area=BOM.area,dealerInfo.callbackActivatedFlag=BOM.callbackActivatedFlag,dealerInfo.cityZipcodeLine=BOM.postalCode,dealerInfo.companyId=BOM.companyId,dealerInfo.contactEmailLine=BOM.contactEmail,dealerInfo.contactFaxLine=BOM.contactFax,dealerInfo.contactImageUrl=BOM.contactImageUrl,dealerInfo.contactNameLine=BOM.contactName,dealerInfo.contactPhoneLine=BOM.contactPhone,dealerInfo.district=BOM.district,dealerInfo.links=BOM.links,dealerInfo.nameLine1=BOM.name1,dealerInfo.nameLine2=BOM.name2,dealerInfo.outletId=BOM.outletId,dealerInfo.pobox=BOM.pobox,dealerInfo.region=BOM.region,dealerInfo.subregion=BOM.subregion,dealerInfo.zipCode=BOM.zipCode,angular.equals({},dealerInfo)&&(dealerInfo=void 0),dealerInfo}function generateStageImageWithBlacklist(stageImage,images){var result=!1;if(!stageImage)return result;var metaData=stageImage.metaData;if(!metaData)return result=generateStageImage(stageImage,images);for(var i=0;i<metaData.length;i++){var perspectiveCodes=metaData[i].text;if("BBD_BLACKLIST"===metaData[i].code&&perspectiveCodes&&""!==perspectiveCodes){var blackList=perspectiveCodes.split(",");result=generateStageImage(stageImage,images,blackList);break}result=generateStageImage(stageImage,images)}return result}function generateStageImage(stageImage,resultImages,blackList){var imagesConfigJson=ConfigService.getInternalConfig(CONFIG_IMAGES_BBD);if(!imagesConfigJson)return!1;var imagesConfig=null;try{imagesConfig=JSON.parse(imagesConfigJson)}catch(e){return!1}var dimensionFormatMap=imagesConfig.DimensionFormatMap,useCases=imagesConfig.UseCases;if(!dimensionFormatMap||!useCases)return!1;for(var fomImageTypeName in useCases){resultImages[fomImageTypeName]=[];var fomImageType=useCases[fomImageTypeName];for(var fomPerspectiveName in fomImageType)for(var fomPerspective=fomImageType[fomPerspectiveName],i=0;i<fomPerspective.length;i++){var dimensionPovPair=fomPerspective[i].split(":"),bbdDimension=dimensionPovPair[0].trim(),bbdPov=dimensionPovPair[1].trim(),bbdUrl=stageImage.url.trim();if(!(blackList&&blackList.indexOf(bbdPov)>-1)){var imageFormat=dimensionFormatMap[bbdDimension].trim(),imagePerspective=fomPerspectiveName.trim(),imageSource=stageImage.source.trim(),imageUrl=bbdUrl+"&IMGT="+bbdDimension+"&POV="+bbdPov,fomImageInfoDay={format:imageFormat,perspective:imagePerspective,source:imageSource,url:imageUrl,perspectiveCode:bbdPov},fomImageInfoNight={format:imageFormat,perspective:imagePerspective,source:imageSource,url:imageUrl+",SZN",perspectiveCode:bbdPov,isNight:!0};resultImages[fomImageTypeName].push(fomImageInfoDay),resultImages[fomImageTypeName].push(fomImageInfoNight)}}}return!0}function createFomImage(image){var fomImageToCreate={format:image.format,perspective:image.perspective,source:image.source,url:image.url,imageId:image.imageId};return image.metaData&&(fomImageToCreate.metadata=[],image.metaData.constructor===Array?angular.forEach(image.metaData,function(md){var entry={code:md.code,text:md.text};fomImageToCreate.metadata.push(entry)}):fomImageToCreate.metadata.push({code:image.metaData})),fomImageToCreate}function createMediaVideos(BOM){var videos={};return angular.forEach(BOM.media.videos,function(video){var fomVideo={format:video.format,source:video.source,url:video.url,code:video.code,text:video.text},videoType=video.type;videos[videoType]||(videos[videoType]=[]),video.metaData&&(fomVideo.metadata=[],video.metaData.constructor===Array?angular.forEach(video.metaData,function(md){var entry={code:md.code,text:md.text};fomVideo.metadata.push(entry)}):fomVideo.metadata.push({code:video.metaData})),videos[videoType].push(fomVideo)}),angular.equals({},videos)&&(videos=void 0),videos}function setNumberOfItems(numberOfItems){var result;return numberOfItems>0&&(result=numberOfItems),result}function setTechnicalDataWeight(technicalDataToUpdate,bomTechnicalData){technicalDataToUpdate.weightKerb=FOMRulesService.formatWeight(bomTechnicalData.weightKerb),technicalDataToUpdate.weightMaxTotal=FOMRulesService.formatWeight(bomTechnicalData.weightMaxTotal),technicalDataToUpdate.weightPayload=FOMRulesService.formatWeight(bomTechnicalData.weightPayload),technicalDataToUpdate.wheelBase=FOMRulesService.formatWheelbase(bomTechnicalData.wheelbase)}function updateTechnicalDataWithEnginePrimaryInformation(enginePrimary,technicalData,isAlternativeDrive){enginePrimary.batteryType&&(technicalData.batteryType1=enginePrimary.batteryType.text),technicalData.acceleration1=FOMRulesService.formatAcceleration(enginePrimary.acceleration),technicalData.topSpeed1=FOMRulesService.formatSpeed(enginePrimary.topSpeed);var engineTypeCode;enginePrimary.engineType&&(technicalData.engineType1=enginePrimary.engineType.text,engineTypeCode=enginePrimary.engineType.code),technicalData.chargingTime1=FOMRulesService.formatChargingTime(enginePrimary.chargingTime),technicalData.batteryCapacity1=FOMRulesService.formatBatteryCapacity(enginePrimary.batteryCapacity),technicalData.co2EmissionCity1=FOMRulesService.formatCo2Emission(enginePrimary.co2EmissionCityMin,enginePrimary.co2EmissionCityMax,enginePrimary.co2EmissionUnit,engineTypeCode),technicalData.co2EmissionCombined1=FOMRulesService.formatCo2Emission(enginePrimary.co2EmissionCombinedMin,enginePrimary.co2EmissionCombinedMax,enginePrimary.co2EmissionUnit,engineTypeCode),technicalData.co2EmissionOverland1=FOMRulesService.formatCo2Emission(enginePrimary.co2EmissionOverlandMin,enginePrimary.co2EmissionOverlandMax,enginePrimary.co2EmissionUnit,engineTypeCode);var primaryFuelTypeCode;technicalData.consumptionCity1=FOMRulesService.formatConsumption(enginePrimary.consumptionCityMin,enginePrimary.consumptionCityMax,primaryFuelTypeCode),technicalData.consumptionCombined1=FOMRulesService.formatConsumption(enginePrimary.consumptionCombinedMin,enginePrimary.consumptionCombinedMax,primaryFuelTypeCode),technicalData.consumptionOverland1=FOMRulesService.formatConsumption(enginePrimary.consumptionOverlandMin,enginePrimary.consumptionOverlandMax,primaryFuelTypeCode);var cilinderCapacity1=FOMRulesService.formatCcm(enginePrimary.cylinderCapacity);technicalData.cylinderCapacity1=cilinderCapacity1,technicalData.cylinderCapacity=cilinderCapacity1,technicalData.cylinderType=enginePrimary.cylinderType,technicalData.motorCode=enginePrimary.motorCode,enginePrimary.cylinderNumber&&(technicalData.cylinderNumber=FOMRulesService.formatNumberGeneral(enginePrimary.cylinderNumber),technicalData.cylinderNumber1=technicalData.cylinderNumber),technicalData.fuelTankCapacity1=FOMRulesService.formatFuelTankCapacity(enginePrimary.fuelTankCapacity),enginePrimary.fuelType&&(technicalData.fuelType1=enginePrimary.fuelType.text),technicalData.range1=FOMRulesService.formatRange(enginePrimary.range),technicalData.torque1=FOMRulesService.formatTorque(enginePrimary.torque),isAlternativeDrive&&(technicalData.enginePower1Kw=FOMRulesService.formatPowerKw(enginePrimary.powerKW),technicalData.enginePower1Hp=FOMRulesService.formatPowerHp(enginePrimary.powerPS))}function updateTechnicalDataWithEngineSecondaryInformation(engineSecondary,enginePrimary,technicalData,isAlternativeDrive){var secondaryFuelTypeCode="";engineSecondary.fuelType&&(secondaryFuelTypeCode=engineSecondary.fuelType.code,technicalData.fuelType2=engineSecondary.fuelType.text),technicalData.acceleration2=FOMRulesService.formatAcceleration(engineSecondary.acceleration),technicalData.topSpeed2=FOMRulesService.formatSpeed(engineSecondary.topSpeed),engineSecondary.batteryType&&(technicalData.batteryType2=engineSecondary.batteryType.text);var secondaryEngineTypeCode;engineSecondary.engineType&&(technicalData.engineType2=engineSecondary.engineType.text,secondaryEngineTypeCode=engineSecondary.engineType.code),engineSecondary.cylinderNumber&&(technicalData.cylinderNumber2=FOMRulesService.formatNumberGeneral(engineSecondary.cylinderNumber)),technicalData.chargingTime2=FOMRulesService.formatChargingTime(engineSecondary.chargingTime),technicalData.batteryCapacity2=FOMRulesService.formatBatteryCapacity(engineSecondary.batteryCapacity),technicalData.co2EmissionCity2=FOMRulesService.formatCo2Emission(engineSecondary.co2EmissionCityMin,engineSecondary.co2EmissionCityMax,enginePrimary.co2EmissionUnit,secondaryEngineTypeCode),technicalData.co2EmissionCombined2=FOMRulesService.formatCo2Emission(engineSecondary.co2EmissionCombinedMin,engineSecondary.co2EmissionCombinedMax,enginePrimary.co2EmissionUnit,secondaryEngineTypeCode),technicalData.co2EmissionOverland2=FOMRulesService.formatCo2Emission(engineSecondary.co2EmissionOverlandMin,engineSecondary.co2EmissionOverlandMax,enginePrimary.co2EmissionUnit,secondaryEngineTypeCode),technicalData.consumptionCity2=FOMRulesService.formatConsumption(engineSecondary.consumptionCityMin,engineSecondary.consumptionCityMax,secondaryFuelTypeCode),technicalData.consumptionCombined2=FOMRulesService.formatConsumption(engineSecondary.consumptionCombinedMin,engineSecondary.consumptionCombinedMax,secondaryFuelTypeCode),technicalData.consumptionOverland2=FOMRulesService.formatConsumption(engineSecondary.consumptionOverlandMin,engineSecondary.consumptionOverlandMax,secondaryFuelTypeCode),technicalData.cylinderCapacity2=FOMRulesService.formatCcm(engineSecondary.cylinderCapacity),technicalData.fuelTankCapacity2=FOMRulesService.formatFuelTankCapacity(engineSecondary.fuelTankCapacity),technicalData.range2=FOMRulesService.formatRange(engineSecondary.range),technicalData.torque2=FOMRulesService.formatTorque(engineSecondary.torque),isAlternativeDrive&&(technicalData.enginePower2Kw=FOMRulesService.formatPowerKw(engineSecondary.powerKW),technicalData.enginePower2Hp=FOMRulesService.formatPowerHp(engineSecondary.powerPS))}function updateTechnicalDataWithItemsInformation(bomTechnicalDataItems,fomTechnicalData){fomTechnicalData.items=[],bomTechnicalDataItems&&bomTechnicalDataItems.length&&angular.forEach(bomTechnicalDataItems,function(item){var fomItem={id:item.id,value:item.value,unit:item.unit};fomTechnicalData.items.push(fomItem)})}function createUpholstery(upholstery){if(upholstery){var upholsteryToReturn={code:upholstery.code,codeType:"AU",name:upholstery.text},upholsteryColorGroup=upholstery.colorGroup;upholsteryToReturn.colorGroup=upholsteryColorGroup?upholsteryColorGroup.text:void 0;var upholsteryType=upholstery.type;upholsteryToReturn.type=upholsteryType?upholsteryType.text:void 0;var price=createPrice(upholstery.price,!0);if(price){var grossNet=mapPriceGrossAndNet(upholstery.price);price.gross=grossNet.gross,price.net=grossNet.net}return upholsteryToReturn.price=price,upholsteryToReturn}}function createPaint(paint,paintCodeType){if(paint){var paintToReturn={codeType:paintCodeType,code:paint.code,group:paint.groupText,name:paint.text};paintToReturn.type=FOMRulesService.paintType(paint.type);var price=createPrice(paint.price,!0);if(price){var grossNet=mapPriceGrossAndNet(paint.price);price.gross=grossNet.gross,price.net=grossNet.net}return paintToReturn.price=price,paintToReturn}}function createEquipmentPackage(equipmentPackage){if(equipmentPackage){var equipmentPackageToReturn={code:equipmentPackage.code,name:equipmentPackage.name,description:equipmentPackage.description};return createEquipments(equipmentPackage.equipments,equipmentPackageToReturn,!1),equipmentPackageToReturn}}function createEquipments(equipments,response,sort){if(equipments instanceof Array&&equipments.length){var mappedEquipments=[],mappedEquipmentCategories=[],mappedHighlights=[],context=ContextService.getContext(),hasCategory=function(cat){for(var i=0;i<mappedEquipmentCategories.length;i++)if(mappedEquipmentCategories[i].id===cat.id)return!0;return!1},compare=function(a,b){var result=0;return a&&a.text&&b&&b.text&&context&&(result=a.text.toLowerCase().localeCompare(b.text.toLowerCase(),context.language)),result};if(sort&&equipments.sort(compare),angular.forEach(equipments,function(e){var equipment=createEquipment(e),cat={};cat.id=e.categoryCode,cat.name=e.categoryText,hasCategory(cat)||mappedEquipmentCategories.push(cat),e.isHighlighted?mappedHighlights.push(equipment):mappedEquipments.push(equipment)}),mappedEquipments.length&&(response.equipments=mappedEquipments),mappedEquipmentCategories.length){var eqCatToCode=ConfigService.getInternalConfig(CONFIG_EQUIPMENT_CAT_TO_CODE);if(eqCatToCode){var eqCatToCodeKeys=Object.keys(JSON.parse(eqCatToCode)),eqCatToGroupCode=ConfigService.getInternalConfig(CONFIG_EQUIPMENT_CAT_TO_GROUP_CODE);if(eqCatToGroupCode){var eqCatToGroupCodeKeys=Object.keys(JSON.parse(eqCatToGroupCode));eqCatToGroupCodeKeys=eqCatToGroupCodeKeys.filter(function(e){return eqCatToCodeKeys.indexOf(e)<0}),eqCatToCodeKeys=eqCatToCodeKeys.concat(eqCatToGroupCodeKeys)}var sortedEquipmentCategories=[];angular.forEach(eqCatToCodeKeys,function(category){angular.forEach(mappedEquipmentCategories,function(mappedCategory){mappedCategory.id===category&&sortedEquipmentCategories.push(mappedCategory)})}),response.equipmentCategories=sortedEquipmentCategories}else response.equipmentCategories=mappedEquipmentCategories}mappedHighlights.length&&(response.highlights=mappedHighlights)}}function createEquipment(equipment){if(equipment){var price=createPrice(equipment.price,!0);if(price){var grossNet=mapPriceGrossAndNet(equipment.price);price.gross=grossNet.gross,price.net=grossNet.net}var equipmentToReturn={categoryId:equipment.categoryCode,code:equipment.code,group:equipment.groupText,name:equipment.text,entryType:equipment.entryType};return equipmentToReturn.price=price,equipmentToReturn.codeType=FOMRulesService.equipmentType(equipment.type),equipmentToReturn.visible=FOMRulesService.equipmentVisibility(equipment.visibility),equipmentToReturn}}var CONFIG_IMAGES_BBD="images.bbd.configuration",CONFIG_EQUIPMENT_CAT_TO_CODE="equipmentCategoriesToCode",CONFIG_EQUIPMENT_CAT_TO_GROUP_CODE="equipmentCategoriesToGroupCode",CONFIG_UI_WARRANTY_CODE_TEXT="ui.warranty.codetext",mapCommercialVehicleData=function(BOM){if(BOM.commercialVehicleData){var response={};return BOM.commercialVehicleData.body&&(response.body=BOM.commercialVehicleData.body.text),BOM.commercialVehicleData.cabin&&(response.cabin=BOM.commercialVehicleData.cabin.text),BOM.commercialVehicleData.suspension&&(response.suspension=BOM.commercialVehicleData.suspension.text),BOM.commercialVehicleData.vehicleGroup&&(response.vehicleGroup=BOM.commercialVehicleData.vehicleGroup.text),response.bodymassHeight=FOMRulesService.formatHeight(BOM.commercialVehicleData.bodymassHeight),response.bodymassLength=FOMRulesService.formatLength(BOM.commercialVehicleData.bodymassLength),response.bodymassWidth=FOMRulesService.formatWidth(BOM.commercialVehicleData.bodymassWidth),response.bodymassVolumeCcm=FOMRulesService.formatCcm(BOM.commercialVehicleData.bodymassVolumeCcm),response.bodymassVolumeLiter=FOMRulesService.formatLiter(BOM.commercialVehicleData.bodymassVolumeLiter),angular.equals({},response)&&(response=void 0),response}},mapCondition=function(BOM){if(BOM.vehicleCondition){var response={};BOM.vehicleData&&(BOM.vehicleData.finalInspectionDate&&(response.finalInspectionDate=FOMRulesService.formatFinalInspectionDate(BOM.vehicleData.finalInspectionDate)),BOM.vehicleData.firstRegistrationDate&&(response.firstRegistrationDate=FOMRulesService.formatFirstRegDate(BOM.vehicleData.firstRegistrationDate),response.firstRegistrationDate2=FOMRulesService.formatFirstRegDate2(BOM.vehicleData.firstRegistrationDate)),BOM.vehicleData.deRegistrationDate&&(response.deRegistrationDate=FOMRulesService.formatDeRegistrationDate(BOM.vehicleData.deRegistrationDate)),BOM.vehicleData.deliveryDate&&(response.deliveryDate=FOMRulesService.formatDeliveryDate(BOM.vehicleData.deliveryDate)),BOM.vehicleData.deliveryDateFrom&&(response.deliveryDateFrom=FOMRulesService.formatDeliveryDate(BOM.vehicleData.deliveryDateFrom)),BOM.vehicleData.deliveryDateTo&&(response.deliveryDateTo=FOMRulesService.formatDeliveryDate(BOM.vehicleData.deliveryDateTo)),BOM.vehicleData.invoiceToDealerDate&&(response.invoiceToDealerDate=FOMRulesService.formatInvoiceToDealerDate(BOM.vehicleData.invoiceToDealerDate)),BOM.vehicleData.allocationPeriod&&(response.allocationPeriod=FOMRulesService.formatAllocationPeriod(BOM.vehicleData.allocationPeriod)));var firstVehicleUsageCode;BOM.vehicleCondition.firstVehicleUsage&&(response.firstVehicleUsage=BOM.vehicleCondition.firstVehicleUsage.text,firstVehicleUsageCode=BOM.vehicleCondition.firstVehicleUsage.code),response.hasPreviousDamage=FOMRulesService.setYesNo(BOM.vehicleCondition.hasPreviousDamage),response.damagesRepaired=BOM.vehicleCondition.damagesRepaired,BOM.vehicleCondition.inspectionEmission&&(response.inspectionEmission=FOMRulesService.formatInspectionDate(BOM.vehicleCondition.inspectionEmission)),BOM.vehicleCondition.inspectionTechnical&&(response.inspectionTechnical=FOMRulesService.formatInspectionDate(BOM.vehicleCondition.inspectionTechnical)),response.mileage=FOMRulesService.formatMileage(BOM.vehicleCondition.mileage);var licenseState=BOM.vehicleData&&BOM.vehicleData.licenseState&&BOM.vehicleData.licenseState.code,mileageText=FOMRulesService.formatMileageText(BOM.vehicleCondition.mileage),mileagePrefix=FOMRulesService.formatMileagePrefix(firstVehicleUsageCode,licenseState);response.mileageText=mileageText?mileageText:void 0,response.mileagePrefix=mileagePrefix?mileagePrefix:void 0,BOM.vehicleCondition.numberPreviousOwners&&(response.numberPreviousOwners=BOM.vehicleCondition.numberPreviousOwners),BOM.vehicleCondition.tradeInDate&&(response.tradeInDate=FOMRulesService.formatTradeInDate(BOM.vehicleCondition.tradeInDate));var bomRemarks=BOM.vehicleCondition.remarks;return bomRemarks&&bomRemarks.length&&(response.remarks=bomRemarks),angular.equals({},response)&&(response=void 0),response}},createPrice=function(value,vatReclaimableDefault,handlePoA){var result={};if(void 0!==value&&null!==value&&!angular.equals({},value)){var currency=value.currency,priceGross=value.totalPrice,priceNet=value.basePrice;result.gross=FOMRulesService.formatPrice(priceGross,currency),handlePoA?result.grossRounded=FOMRulesService.formatPrice(priceGross,currency,!0):result.grossRounded=FOMRulesService.formatMoneyCurrency(priceGross,currency,!0),result.net=FOMRulesService.formatPrice(priceNet,currency),handlePoA?result.netRounded=FOMRulesService.formatPrice(priceNet,currency,!0):result.netRounded=FOMRulesService.formatMoneyCurrency(priceNet,currency,!0),result.vatReclaimable=FOMRulesService.vatReclaimable(value.vatReclaimable,vatReclaimableDefault);var taxInfos=value.taxInfos;return taxInfos&&taxInfos.length&&(result.taxes=[],angular.forEach(taxInfos,function(st){var fomTaxInfo={};fomTaxInfo.amount=FOMRulesService.formatMoneyCurrency(st.taxAmount,currency),st.type&&(fomTaxInfo.label=st.type.text,fomTaxInfo.type=st.type.code),fomTaxInfo.rate=FOMRulesService.formatPercent(st.taxRate),angular.equals({},fomTaxInfo)||result.taxes.push(fomTaxInfo)},this)),result.taxes&&!result.taxes.length&&(result.taxes=void 0),angular.equals({},result)&&(result=void 0),result}},mapDealer=function(BOM){var response={};return BOM.geoLocation&&(BOM.geoLocation.latitude||BOM.geoLocation.longitude)&&(response.geoLocation={},BOM.geoLocation.latitude&&(response.geoLocation.latitude=BOM.geoLocation.latitude),BOM.geoLocation.longitude&&(response.geoLocation.longitude=BOM.geoLocation.longitude)),BOM.geoPoint&&(BOM.geoPoint.lat||BOM.geoPoint.lon)&&(response.geoPoint={},BOM.geoPoint.lat&&(response.geoPoint.lat=BOM.geoPoint.lat),BOM.geoPoint.lon&&(response.geoPoint.lon=BOM.geoPoint.lon)),BOM.formatted&&(response.formatted=updateFormattedDealerInformation(BOM.formatted)),response.destinationKey=BOM.destinationKey,response=updateDealerInformation(BOM,response)},mapFinancings=function(BOM){if(BOM.financeData){var response=[],financing={};if(financing.currency=BOM.financeData.currency,BOM.priceInformation&&BOM.priceInformation.offerPrice&&BOM.priceInformation.offerPrice.currency){var rate=BOM.financeData.rate,currency=BOM.priceInformation.offerPrice.currency;financing.rate=FOMRulesService.formatMoneyCurrency(rate,currency),financing.rateRounded=FOMRulesService.formatMoneyCurrency(rate,currency,!0)}return financing.messages=BOM.financeData.messages,financing.customerType=BOM.financeData.customerType,BOM.financeData.financingProduct&&(financing.financingProduct={},financing.financingProduct.id=BOM.financeData.financingProduct.id,financing.financingProduct.label=BOM.financeData.financingProduct.label),BOM.financeData.financingValues&&BOM.financeData.financingValues.length&&(financing.financingValues=[],angular.forEach(BOM.financeData.financingValues,function(fv){var fomFinancingValue={attrId:fv.attrId,disclaimer:fv.disclaimer,highlight:fv.highlight,infoTextKey:fv.infoTextKey,label:fv.label,unit:fv.unit,value:fv.value,valueText:fv.valueText};financing.financingValues.push(fomFinancingValue)})),angular.equals({},financing)||response.push(financing),response.length||(response=void 0),response}},mapMedia=function(BOM){if(BOM.media){var response={},media=BOM.media,images=media.images;if(images&&images.length>0){response.images={};for(var stageImage,index=0;index<images.length;index++)if("STAGE_IMAGE"===images[index].type){stageImage=images[index],images.splice(index,1);break}if(stageImage){var result=generateStageImageWithBlacklist(stageImage,response.images);if(!result)return}angular.forEach(images,function(image){var fomImage=createFomImage(image),imageType=image.type;response.images[imageType]||(response.images[imageType]=[]),response.images[imageType].push(fomImage)})}return media.videos&&(response.videos=createMediaVideos(BOM)),media.bannerTexts&&(response.bannerTexts=media.bannerTexts),angular.equals({},response)&&(response=void 0),response}},mapConsignment=function(BOM){if(BOM.consignment){var consignment={};return consignment.location=BOM.consignment.location,consignment.entryDate=FOMRulesService.formatEntryDate(BOM.consignment.entryDate),consignment}},mapPriceGrossAndNet=function(price,currency,handlePoA){var response={},currencyValue=currency?currency:price.currency;return handlePoA?(response.gross=FOMRulesService.formatPrice(price.totalPrice,currencyValue),response.net=FOMRulesService.formatPrice(price.basePrice,currencyValue)):(response.gross=FOMRulesService.formatMoneyCurrency(price.totalPrice,currencyValue),response.net=FOMRulesService.formatMoneyCurrency(price.basePrice,currencyValue)),response},mapSpecificPrice=function(response,price,currency,grossField,netField){var defaultPrice=FOMRulesService.formatPrice(),gross=defaultPrice,net=defaultPrice;if(price){var grossNet=mapPriceGrossAndNet(price,currency,!0);gross=grossNet.gross,net=grossNet.net}response[grossField]=gross,response[netField]=net},mapPriceInfo=function(BOM){if(BOM.priceInformation&&BOM.priceInformation.offerPrice){var response={};return response.offerPrice=createPrice(BOM.priceInformation.offerPrice,!1,!0),
response.newPrice=createPrice(BOM.priceInformation.newPrice),response.newPriceExcludingEquipments=createPrice(BOM.priceInformation.newPriceExcludingEquipments),response.offerPrice&&(mapSpecificPrice(response.offerPrice,BOM.priceInformation.offerPricePrevious,BOM.priceInformation.offerPrice.currency,"grossPrevious","netPrevious"),mapSpecificPrice(response.offerPrice,BOM.priceInformation.offerPriceReference,BOM.priceInformation.offerPrice.currency,"grossReference","netReference")),FOMRulesService.sortOrderTaxes(response),angular.equals({},response)&&(response=void 0),response}},mapSalesInfo=function(BOM){if(BOM.salesInformation){var response={};if(response.salesProgram=BOM.salesInformation.salesProgram,response.onlineSales=BOM.salesInformation.onlineSales,BOM.salesInformation.warranty){var shouldWarrantyBeCodeText=ConfigService.getInternalConfig(CONFIG_UI_WARRANTY_CODE_TEXT);"true"===shouldWarrantyBeCodeText?response.warranty={code:BOM.salesInformation.warranty.code,text:BOM.salesInformation.warranty.text}:response.warranty=BOM.salesInformation.warranty.text}return angular.equals({},response)&&(response=void 0),response}},mapTechnicalData=function(BOM){var technicalData=BOM.technicalData;if(technicalData){var response={},vehicleConfiguration=BOM.vehicleConfiguration,isAlternativeDrive=void 0!==vehicleConfiguration.alternativeDriveType;return response.acceleration=FOMRulesService.formatAcceleration(technicalData.acceleration),response.allWheel=FOMRulesService.setYesNo(technicalData.allwheel),response.allwheel=FOMRulesService.setYesNo(technicalData.allwheel),technicalData.connectMeFeature&&(response.connectMeFeature=FOMRulesService.connectMeFeature(technicalData.connectMeFeature)),technicalData.enginePrimary&&updateTechnicalDataWithEnginePrimaryInformation(technicalData.enginePrimary,response,isAlternativeDrive),technicalData.engineSecondary&&updateTechnicalDataWithEngineSecondaryInformation(technicalData.engineSecondary,technicalData.enginePrimary,response,isAlternativeDrive),technicalData.items&&updateTechnicalDataWithItemsInformation(technicalData.items,response),response.co2EmissionCombined=response.co2EmissionCombined1?response.co2EmissionCombined1:response.co2EmissionCombined2,response.consumptionCombined=response.consumptionCombined1?response.consumptionCombined1:response.consumptionCombined2,technicalData.emissionStandard&&technicalData.emissionStandard.text&&(response.emissionStandard=technicalData.emissionStandard.text),response.cwValue=technicalData.cwValue,response.energyEfficiencyClass=FOMRulesService.energyEfficiencyClass(technicalData.energyEfficiencyClass),response.enginePower=FOMRulesService.formatEnginePower(BOM),response.enginePower1=FOMRulesService.formatEnginePowerPrimary(BOM),response.enginePower2=FOMRulesService.formatEnginePowerSecondary(BOM),technicalData.engineType&&(response.engineType=technicalData.engineType.text),response.fineParticle=FOMRulesService.fineParticle(technicalData.fineParticle),response.numberOfDoors=setNumberOfItems(technicalData.numberOfDoors),response.numberOfGears=setNumberOfItems(technicalData.numberOfGears),response.numberOfSeats=setNumberOfItems(technicalData.numberOfSeats),technicalData.enginePrimary&&technicalData.enginePrimary.range&&(response.range=parseInt(technicalData.enginePrimary.range),technicalData.engineSecondary&&technicalData.engineSecondary.range&&(response.range+=parseInt(technicalData.engineSecondary.range))),technicalData.testProcedure&&(response.testProcedure=technicalData.testProcedure),response.steering=technicalData.steering,response.topSpeed=FOMRulesService.formatSpeed(technicalData.topSpeed),response.torque=FOMRulesService.formatTorque(technicalData.torque),isAlternativeDrive&&(response.fuelTypeCombined=FOMRulesService.formatFuelTypeCombined(response.fuelType1,response.fuelType2),response.fuelTankCapacityCombined=FOMRulesService.formatFuelTankCapacityCombined(response.fuelTankCapacity1,response.fuelType1,response.fuelTankCapacity2,response.fuelType2),response.enginePowerCombined=FOMRulesService.formatEnginePowerCombined(response.enginePower1Kw,response.enginePower2Kw,response.enginePower1Hp,response.enginePower2Hp),response.enginePowerCombinedKw=FOMRulesService.formatEnginePowerCombinedKw(response.enginePower1Kw,response.enginePower2Kw),response.enginePowerCombinedHp=FOMRulesService.formatEnginePowerCombinedHp(response.enginePower1Hp,response.enginePower2Hp)),vehicleConfiguration.transmissionType&&(response.transmissionText=FOMRulesService.textTransmission(technicalData.numberOfGears,vehicleConfiguration.transmissionType.code),response.transmissionType=vehicleConfiguration.transmissionType.text),setTechnicalDataWeight(response,technicalData),BOM.commercialVehicleData&&(response.wheelForm=BOM.commercialVehicleData.wheelForm),angular.equals({},response)&&(response=void 0),response}},mapDMSData=function(BOM){if(BOM.dmsData){var response={},dmsDataLabels=BOM.dmsData.labels;return dmsDataLabels&&dmsDataLabels.length&&(response.labels=[],angular.forEach(dmsDataLabels,function(dmsDataLabelValue){var label={};label.label=dmsDataLabelValue.label,label.value=dmsDataLabelValue.value,response.labels.push(label)})),angular.equals({},response)&&(response=void 0),response}},mapVehicleConfiguration=function(BOM){if(BOM.vehicleConfiguration){var response={};BOM.vehicleData&&(BOM.vehicleData.brand&&(response.brand=BOM.vehicleData.brand.text),response.baumuster=BOM.vehicleData.baumuster,response.isAmg=BOM.vehicleData.isAmg),BOM.vehicleConfiguration.bodyGroup&&(response.bodyGroup=BOM.vehicleConfiguration.bodyGroup.text);var vehicleConfigurationLines=BOM.vehicleConfiguration.lines;if(vehicleConfigurationLines&&vehicleConfigurationLines.length&&(response.equipmentLines=[],angular.forEach(vehicleConfigurationLines,function(lt){var line={};line.code=lt.code,line.codeType="LI",line.lineType=FOMRulesService.lineType(lt.type),line.name=lt.text,response.equipmentLines.push(line)})),createEquipments(BOM.vehicleConfiguration.equipments,response,!0),BOM.vehicleConfiguration.equipmentPackages instanceof Array&&BOM.vehicleConfiguration.equipmentPackages.length){var equipmentPackages=[];angular.forEach(BOM.vehicleConfiguration.equipmentPackages,function(e){var equipmentPacakge=createEquipmentPackage(e);equipmentPackages.push(equipmentPacakge)}),response.equipmentPackages=equipmentPackages}if(BOM.vehicleConfiguration.lengthGroup&&BOM.vehicleConfiguration.lengthGroup.text&&(response.lengthGroup=BOM.vehicleConfiguration.lengthGroup.text),response.modelYear=BOM.vehicleConfiguration.modelYear,BOM.vehicleData&&(response.nst=BOM.vehicleData.nst),response.paintPrimary=createPaint(BOM.vehicleConfiguration.paintPrimary,"LU"),response.paintSecondary=createPaint(BOM.vehicleConfiguration.paintSecondary,"LO"),response.paintTertiary=createPaint(BOM.vehicleConfiguration.paintTertiary),BOM.vehicleConfiguration.wheel&&(response.rim={},angular.forEach(response.equipments,function(e){e.code===BOM.vehicleConfiguration.wheel.code&&(response.rim.categoryId=e.categoryId)}),response.rim.code=BOM.vehicleConfiguration.wheel.code,response.rim.name=BOM.vehicleConfiguration.wheel.text,response.rim.codeType="SA"),response.equipments&&response.rim){var filteredEquipment=response.equipments.filter(function(value){return value.code===response.rim.code});filteredEquipment&&filteredEquipment[0]&&(response.rim.categoryId=filteredEquipment[0].categoryId)}return BOM.vehicleConfiguration.salesClass&&(response.salesClass=BOM.vehicleConfiguration.salesClass.text),BOM.vehicleConfiguration.currentSalesModel&&(response.currentSalesModel=BOM.vehicleConfiguration.currentSalesModel.text),response.salesClassBody=BOM.vehicleConfiguration.salesClassBody,response.salesDescription=BOM.vehicleConfiguration.salesDescription,response.modelYearCode=BOM.vehicleConfiguration.modelYearCode,response.isMotorhome=BOM.vehicleConfiguration.isMotorhome,response.driveConcept=BOM.vehicleConfiguration.driveConcept,BOM.vehicleConfiguration.specialEdition&&(response.specialEditions=[],angular.forEach(BOM.vehicleConfiguration.specialEdition,function(se){var entry={};entry.code=se.code,entry.codeType="PC",entry.name=se.text,response.specialEditions.push(entry)})),BOM.vehicleConfiguration.specificationDate&&(response.specificationDate=FOMRulesService.formatSpecificationDate(BOM.vehicleConfiguration.specificationDate),response.alterable=FOMRulesService.formatAlterable(BOM.vehicleConfiguration.alterable)),BOM.vehicleConfiguration.trim&&(response.trim={},response.trim.categoryId=FOMRulesService.retrieveEquipCat(BOM,BOM.vehicleConfiguration.trim.code),response.trim.code=BOM.vehicleConfiguration.trim.code,response.trim.codeType="SA",response.trim.name=BOM.vehicleConfiguration.trim.text),response.upholstery=createUpholstery(BOM.vehicleConfiguration.upholstery),angular.equals({},response)&&(response=void 0),response}},mapGenericFields=function(BOM){if(BOM.genericFields){var response={},genericFields=BOM.genericFields;for(var field in genericFields)if(genericFields.hasOwnProperty(field)){var value=genericFields[field];field.indexOf("Int")>-1&&value&&(value=FOMRulesService.formatNumberGeneral(value)),response[field]=value}return angular.equals({},response)&&(response=void 0),response}},mapReservation=function(BOM){if(BOM.reservation){var response={},reservation=BOM.reservation;return reservation.reservedUntil&&(response.reservedUntil=FOMRulesService.formatReservedUntil(BOM.reservation.reservedUntil)),reservation.reservedBy&&(response.reservedBy=mapDealer(reservation.reservedBy)),angular.equals({},response)&&(response=void 0),response}},FOM=function(BOM){if(BOM.vehicleData&&BOM.vehicleData.applicationType){var applicationType={code:BOM.vehicleData.applicationType.code,text:BOM.vehicleData.applicationType.text};this.applicationType=applicationType}this.commercialVehicleData=mapCommercialVehicleData(BOM),this.condition=mapCondition(BOM),BOM.vehicleLocation&&(this.dealer=mapDealer(BOM.vehicleLocation)),this.financings=mapFinancings(BOM),this.id=BOM.id,this.idReference=BOM.idReference,this.transactionId=BOM.transactionId;var status=BOM.status;status&&(this.status=status.code),this.distanceRaw=BOM.distance,this.distance=FOMRulesService.formatDistance(BOM.distance),this.media=mapMedia(BOM);var vehicleData=BOM.vehicleData;if(vehicleData){this.orderDate=vehicleData.orderDate;var availability=vehicleData.availability;availability&&(this.availability=availability.text);var licenseState=vehicleData.licenseState;licenseState&&(this.licenseState=licenseState.text),this.orderNumber=vehicleData.orderNumber;var orderStatus=vehicleData.orderStatus;if(orderStatus&&(this.orderStatus=orderStatus.text),this.registrationPlate=vehicleData.registrationPlate,this.condition&&this.condition.remarks&&this.condition.remarks.length){var firstRemark=this.condition.remarks[0];firstRemark&&(this.remark=firstRemark.constructor===Object?firstRemark.text:firstRemark)}!this.remark&&vehicleData.remark&&(this.remark=vehicleData.remark),this.ucNumber=vehicleData.ucNumber,this.uvnNumber=vehicleData.uvnNumber,this.fin=vehicleData.fin,this.division=vehicleData.division,this.onlineSalesTrackingID=vehicleData.onlineSalesTrackingID,this.engineNumber=vehicleData.engineNumber}if(this.consignment=mapConsignment(BOM),this.priceInfo=mapPriceInfo(BOM),this.technicalData=mapTechnicalData(BOM),this.salesInfo=mapSalesInfo(BOM),BOM.metaData){var bomUpdateDate=BOM.metaData.updatedDate,bomVehicleCategory=BOM.metaData.vehicleCategory,bomStockCategory=BOM.metaData.stockCategory,bomLegalStockCategory=BOM.metaData.legalStockCategory;bomUpdateDate&&(this.updatedDate=bomUpdateDate),bomVehicleCategory&&(this.vehicleCategory=bomVehicleCategory.text),bomStockCategory&&(this.stockCategory=bomStockCategory.code),bomLegalStockCategory&&(this.legalStockCategory=bomLegalStockCategory)}this.vehicleConfiguration=mapVehicleConfiguration(BOM),this.genericFields=mapGenericFields(BOM),this.dmsData=mapDMSData(BOM),this.reservation=mapReservation(BOM)};return FOM.prototype.getBbdImages=function(imageType,isNight){var imagesArray=[];if(this.media&&this.media.images){var imagesByType=this.media.images[imageType];if(imagesByType)for(var i=0;i<imagesByType.length;i++){var imageInfo=imagesByType[i];(isNight&&imageInfo.isNight||!isNight&&!imageInfo.isNight)&&imagesArray.push(imageInfo)}}return imagesArray},{mapBOMToFOM:function(BOM){var fom;return void 0!==BOM&&(fom=new FOM(BOM)),fom}}}]),angular.module("base.jsif").factory("FOMRulesService",["MasterDataService","$interpolate",function(MasterDataService,$interpolate){var BACKEND_DATE_FORMAT="YYYYMMDD",GeneralRules={format:function(template,parameters){if(template&&""!==template){var interpolation=$interpolate(template),result=interpolation(parameters);return result}},formatNum:function(pattern,number){if(void 0!==number&&pattern&&""!==pattern){var p=pattern.split(":"),thSep=p[0],decSep=p[1],decimals=parseInt(p[2]),parsedNumber=parseFloat(number).toFixed(decimals);parsedNumber=parsedNumber.replace(".",decSep);for(var integerPart=parsedNumber.split(decSep)[0],len=integerPart.length,formattedIntegerPart="",initPos=len%3,i=0;i<len;i++)i%3===initPos&&i&&(formattedIntegerPart+=thSep),formattedIntegerPart+=integerPart[i];return formattedIntegerPart.length?parsedNumber.replace(integerPart,formattedIntegerPart):parsedNumber}},formatNumberText:function(value,numberField,textField,allowZero){var result;if(value>0||0===value&&allowZero){var response=MasterDataService.getMDSync(["UI_FORMAT"]),numFormat="",textFormat="";response&&response.results&&response.results.UI_FORMAT&&(numFormat=response.results.UI_FORMAT[numberField]||"",textFormat=response.results.UI_FORMAT[textField]||"");var _value=GeneralRules.formatNum(numFormat,value);void 0!==_value&&(result=GeneralRules.format(textFormat,{value:_value}))}return result},formatMinMax:function(valueMin,valueMax,unit,numFormat,genFormat,isZeroAllowed){var result;if(valueMin>0||0===valueMin&&isZeroAllowed){var _valueMin=GeneralRules.formatNum(numFormat,valueMin),_valueMax=valueMax&&valueMax>valueMin?GeneralRules.formatNum(numFormat,valueMax):void 0;result=GeneralRules.format(genFormat,{valueMin:_valueMin,valueMax:_valueMax,unit:unit})}return result},formatCompactDate:function(date,masterDataCode){if(date){var response=MasterDataService.getMDSync(["UI_FORMAT"]),format=response&&response.results&&response.results.UI_FORMAT?response.results.UI_FORMAT[masterDataCode]||"":"",formattedDate=window.moment(date,BACKEND_DATE_FORMAT).format(""!==format?format:BACKEND_DATE_FORMAT);return formattedDate}}},Util={getMDSyncFormat:function(types,codeName){var response=MasterDataService.getMDSync(types),format="";return response&&response.results&&response.results[types]&&(format=void 0!==codeName?response.results[types][codeName]||"":response.results[types]||""),format},formatPower:function(bomVehicle,engineType){var engineData=bomVehicle&&bomVehicle.technicalData?bomVehicle.technicalData[engineType]:void 0;if(engineData){var result,_powerPSValue=Util.formatSimplePower(engineData.powerPS,"format.unit.powerPS"),_powerKWValue=Util.formatSimplePower(engineData.powerKW,"format.unit.powerKW");return result=Util.buildPowerResult(_powerPSValue,_powerKWValue)}},formatSimplePower:function(powerValue,mdUnitKey){if(powerValue){var _powerUnit=Util.getMDSyncFormat(["UI_FORMAT"],mdUnitKey),result=powerValue+" "+_powerUnit;return result}},buildPowerResult:function(_powerPSValue,_powerKWValue){if(_powerPSValue||_powerKWValue){var result,format=Util.getMDSyncFormat(["UI_FORMAT"],"format.text.powerFull");return format.indexOf(" ")>-1&&(_powerPSValue?_powerKWValue||(format=format.split(" ")[0],format=format.replace("powerKW","powerPS")):format=format.split(" ")[0]),result=GeneralRules.format(format,{powerPS:_powerPSValue,powerKW:_powerKWValue})}}};return{formatEnginePower:function(bomVehicle){var _technicalData=bomVehicle?bomVehicle.technicalData:void 0,_vehicleConfiguration=bomVehicle?bomVehicle.vehicleConfiguration:void 0;if(_vehicleConfiguration&&_technicalData){var result,_powerPSValue,_powerKWValue,_powerPSUnit=Util.getMDSyncFormat(["UI_FORMAT"],"format.unit.powerPS"),_powerKWUnit=Util.getMDSyncFormat(["UI_FORMAT"],"format.unit.powerKW"),_powerPSEnginePrimary="",_powerKWEnginePrimary="",_enginePrimary=_technicalData.enginePrimary;if(_enginePrimary){var _primaryPowerPS=_enginePrimary.powerPS,_primaryPowerKW=_enginePrimary.powerKW;_powerPSEnginePrimary=_primaryPowerPS?_primaryPowerPS+" "+_powerPSUnit:"",_powerKWEnginePrimary=_primaryPowerKW?_primaryPowerKW+" "+_powerKWUnit:""}var _powerPSEngineSecondary,_powerKWEngineSecondary;if(["4","6"].indexOf(_vehicleConfiguration.engineConcept)>-1){var _engineSecondary=_technicalData.engineSecondary;if(_powerPSEngineSecondary="",_powerKWEngineSecondary="",_engineSecondary){var _secondaryPowerPS=_engineSecondary.powerPS,_secondaryPowerKW=_engineSecondary.powerKW;_powerPSEngineSecondary=_secondaryPowerPS?" + "+_secondaryPowerPS+" "+_powerPSUnit:"",_powerKWEngineSecondary=_secondaryPowerKW?" + "+_secondaryPowerKW+" "+_powerKWUnit:""}_powerPSValue=_powerPSEnginePrimary+_powerPSEngineSecondary,_powerKWValue=_powerKWEnginePrimary+_powerKWEngineSecondary}else _powerPSValue=_powerPSEnginePrimary,_powerKWValue=_powerKWEnginePrimary;return result=Util.buildPowerResult(_powerPSValue,_powerKWValue)}},formatEnginePowerPrimary:function(bomVehicle){var enginePower=Util.formatPower(bomVehicle,"enginePrimary");return enginePower},formatEnginePowerSecondary:function(bomVehicle){var enginePower=Util.formatPower(bomVehicle,"engineSecondary");return enginePower},formatMoneyCurrency:function(value,currency,shouldRound){var result;if(value>0){var _value,format="";if(format=shouldRound?Util.getMDSyncFormat(["UI_FORMAT"],"format.number.moneyRounded"):Util.getMDSyncFormat(["UI_FORMAT"],"format.number.money"),shouldRound&&(value=Math.round(value)),_value=GeneralRules.formatNum(format,value)){var formatCurrency=Util.getMDSyncFormat(["UI_FORMAT"],"format.text.moneyCurrency"),_symbol=Util.getMDSyncFormat(["UI_FORMAT"],"currencySymbol."+currency);result=GeneralRules.format(formatCurrency,{value:_value,symbol:_symbol})}}return result},formatPercent:function(value){return GeneralRules.formatNumberText(value,"format.number.percentage","format.text.percentage")},formatNumberGeneral:function(value){var format=Util.getMDSyncFormat(["UI_FORMAT"],"format.number.general");return GeneralRules.formatNum(format,value)},formatConsumption:function(valueMin,valueMax,fuelTypeCode){var _formatConsumptionCode="",_formatConsumptionNumCode="";["F","H","L"].indexOf(fuelTypeCode)>-1?(_formatConsumptionCode="format.text.consumptionGas",_formatConsumptionNumCode="format.number.consumptionGas"):"E"===fuelTypeCode?(_formatConsumptionCode="format.text.consumptionElectro",_formatConsumptionNumCode="format.number.consumptionElectro"):(_formatConsumptionCode="format.text.consumptionPetrol",_formatConsumptionNumCode="format.number.consumptionPetrol");var _formatConsumption=Util.getMDSyncFormat(["UI_FORMAT"],_formatConsumptionCode),_formatConsumptionNum=Util.getMDSyncFormat(["UI_FORMAT"],_formatConsumptionNumCode);return GeneralRules.formatMinMax(valueMin,valueMax,"",_formatConsumptionNum,_formatConsumption)},formatCo2Emission:function(valueMin,valueMax,unit,engineTypeCode){var _formatEmissionText=Util.getMDSyncFormat(["UI_FORMAT"],"format.text.co2Emission"),_formatEmissionNum=Util.getMDSyncFormat(["UI_FORMAT"],"format.number.co2Emission"),isZeroAllowed="7"===engineTypeCode;return GeneralRules.formatMinMax(valueMin,valueMax,unit,_formatEmissionNum,_formatEmissionText,isZeroAllowed)},formatAcceleration:function(value){return GeneralRules.formatNumberText(value,"format.number.acceleration","format.text.acceleration")},formatDistance:function(value){return GeneralRules.formatNumberText(value,"format.number.distance","format.text.distance")},formatSpecificationDate:function(date){var formattedDate=GeneralRules.formatCompactDate(date,"format.date.specificationDate");return formattedDate},formatSpeed:function(value){return GeneralRules.formatNumberText(value,"format.number.speed","format.text.speed")},formatTorque:function(value){return GeneralRules.formatNumberText(value,"format.number.torque","format.text.torque")},formatWeight:function(value){return GeneralRules.formatNumberText(value,"format.number.weight","format.text.weight")},formatLength:function(value){return GeneralRules.formatNumberText(value,"format.number.length","format.text.length")},formatHeight:function(value){return GeneralRules.formatNumberText(value,"format.number.height","format.text.height")},formatWidth:function(value){return GeneralRules.formatNumberText(value,"format.number.width","format.text.width")},formatCcm:function(value){return GeneralRules.formatNumberText(value,"format.number.ccm","format.text.ccm")},formatLiter:function(value){return GeneralRules.formatNumberText(value,"format.number.liter","format.text.liter")},formatWheelbase:function(value){return GeneralRules.formatNumberText(value,"format.number.wheelbase","format.text.wheelbase")},formatMileage:function(value){return GeneralRules.formatNumberText(value,"format.number.mileage","format.text.mileage",!0)},formatRange:function(value){return GeneralRules.formatNumberText(value,"format.number.range","format.text.range")},formatFuelTankCapacity:function(value){return GeneralRules.formatNumberText(value,"format.number.fuelTankCapacity","format.text.fuelTankCapacity")},formatBatteryCapacity:function(value){return GeneralRules.formatNumberText(value,"format.number.batteryCapacity","format.text.batteryCapacity")},formatChargingTime:function(value){return GeneralRules.formatNumberText(value,"format.number.chargingTime","format.text.chargingTime")},formatMileageText:function(value){var text=Util.getMDSyncFormat(["UI_FORMAT"],"format.text.mileageText"),parameters={mileage:value},interpolation=$interpolate(text),result=interpolation(parameters);return result},formatMileagePrefix:function(value,licenseState){var text=Util.getMDSyncFormat(["UI_FORMAT"],"format.text.mileagePrefix"),parameters={code:value,licenseState:licenseState},interpolation=$interpolate(text),result=interpolation(parameters);return result},formatFinalInspectionDate:function(date){var formattedDate=GeneralRules.formatCompactDate(date,"format.date.finalInspection");return formattedDate},formatFirstRegDate:function(date){var formattedDate=GeneralRules.formatCompactDate(date,"format.date.firstRegistration");return formattedDate},formatFirstRegDate2:function(date){var formattedDate=GeneralRules.formatCompactDate(date,"format.date.firstRegistration2");return formattedDate},formatDeRegistrationDate:function(date){var formattedDate=GeneralRules.formatCompactDate(date,"format.date.deRegistrationDate");return formattedDate},formatDeliveryDate:function(date){var formattedDate=GeneralRules.formatCompactDate(date,"format.date.deliveryDate");return formattedDate},formatEntryDate:function(date){var formattedDate=GeneralRules.formatCompactDate(date,"format.date.entryDate");return formattedDate},formatInvoiceToDealerDate:function(date){var formattedDate=GeneralRules.formatCompactDate(date,"format.date.invoiceToDealerDate");return formattedDate},formatAllocationPeriod:function(date){var formattedDate=GeneralRules.formatCompactDate(date,"format.date.allocationPeriod");return formattedDate},formatInspectionDate:function(date){var formattedDate=GeneralRules.formatCompactDate(date,"format.date.inspection");return formattedDate},formatTradeInDate:function(date){var formattedDate=GeneralRules.formatCompactDate(date,"format.date.tradeInDate");return formattedDate},formatReservedUntil:function(date){var formattedDate=GeneralRules.formatCompactDate(date,"format.date.reservedUntil");return formattedDate},textTransmission:function(gears,transTypeCode){var transText=Util.getMDSyncFormat(["TRANSMISSION_TEXT"]),code=transTypeCode||"",key=gears+code;return transText[key]},sortOrderTaxes:function(priceInfo){if(priceInfo&&priceInfo.offerPrice&&priceInfo.offerPrice.taxes&&priceInfo.offerPrice.taxes.length){for(var taxSortOrder=Util.getMDSyncFormat(["UI_FORMAT"],"sort.taxes"),splitTaxSortOrder=taxSortOrder.split(/[,\s]+/g),sortedTaxes=[],i=0;i<splitTaxSortOrder.length;i++){var filterTaxType=function(e){return e.type===splitTaxSortOrder[i]};sortedTaxes=sortedTaxes.concat(priceInfo.offerPrice.taxes.filter(filterTaxType))}sortedTaxes.length&&(priceInfo.offerPrice.taxes=sortedTaxes)}},vatReclaimable:function(flag,ignoreDefaultValue){if(null!==flag&&void 0!==flag||!ignoreDefaultValue){var ix=flag?1:0,vatreclaimableText=Util.getMDSyncFormat(["VATRECLAIMABLE_TEXT"],ix);return""!==vatreclaimableText?vatreclaimableText:void 0}},equipmentType:function(value){if(value)return"STANDARD"===value.toUpperCase()?"PS":"SA"},energyEfficiencyClass:function(value){if(value){var energyEffic=Util.getMDSyncFormat(["ENERGY_EFFIC"],value);return energyEffic}},fineParticle:function(value){if(value){var fineParticle=Util.getMDSyncFormat(["FINE_PARTICLE"],value);return fineParticle}},lineType:function(value){if(value){var lineType=Util.getMDSyncFormat(["LINE_TYPE"],value);return lineType}},paintType:function(value){if(value){var paintType=Util.getMDSyncFormat(["PAINT_TYPE"],value);return paintType}},connectMeFeature:function(value){if(value){var response=Util.getMDSyncFormat(["CONNECT_ME"],value);return response}},retrieveEquipCat:function(bomVehicle,equipCode){var result="";return angular.forEach(bomVehicle.vehicleConfiguration.equipments,function(e){e.code!==equipCode||result||(result=e.categoryCode)}),result},setYesNo:function(flag){var response;if(void 0!==flag){var text=Util.getMDSyncFormat(["YESNO_TEXT"],'"'+flag+'"');response={code:flag,text:text}}return response},formatAlterable:function(alterable){if(alterable===!0||alterable===!1){var configResponse=Util.getMDSyncFormat(["ALTERABLE"],alterable.toString()),textAlterable=""!==configResponse?configResponse:alterable.toString(),response={code:alterable,text:textAlterable};return response}},formatPrice:function(value,currency,shouldRound){var result;if(void 0!==value&&null!==value||(value=0),0==value){var response=MasterDataService.getMDSync(["NO_PRICE_TEXT"]);response.results.NO_PRICE_TEXT&&(result=response.results.NO_PRICE_TEXT[0]||"")}return result||(result=this.formatMoneyCurrency(value,currency,shouldRound)),result},equipmentVisibility:function(value){return"open"===value},formatPowerHp:function(value){return Util.formatSimplePower(value,"format.unit.powerPS")},formatPowerKw:function(value){return Util.formatSimplePower(value,"format.unit.powerKW")},formatFuelTypeCombined:function(fuelType1,fuelType2){if(fuelType1||fuelType2){var format=Util.getMDSyncFormat(["UI_FORMAT"],"format.text.fuelTypeCombined"),result=GeneralRules.format(format,{fuelType1:fuelType1,fuelType2:fuelType2});return result=result?result.replace(/^\s\/\s/g,""):result}},formatFuelTankCapacityCombined:function(fuelTankCapacity1,fuelType1,fuelTankCapacity2,fuelType2){if(fuelTankCapacity1&&fuelType1||fuelTankCapacity2&&fuelType2){var format=Util.getMDSyncFormat(["UI_FORMAT"],"format.text.fuelTankCapacityCombined"),result=GeneralRules.format(format,{fuelTankCapacity1:fuelTankCapacity1,fuelType1:fuelType1,fuelTankCapacity2:fuelTankCapacity2,fuelType2:fuelType2});return result=result?result.replace(/^\s\/\s/g,""):result}},formatEnginePowerCombined:function(fomPower1Kw,fomPower2Kw,fomPower1Hp,fomPower2Hp){if(fomPower1Kw||fomPower2Kw||fomPower1Hp||fomPower2Hp){var format=Util.getMDSyncFormat(["UI_FORMAT"],"format.text.enginePowerCombined"),result=GeneralRules.format(format,{power1Kw:fomPower1Kw,power2Kw:fomPower2Kw,power1Hp:fomPower1Hp,power2Hp:fomPower2Hp});return result&&(result=result.replace(/(^\s\/\s)|(^\s\+\s)/g,""),fomPower2Hp||(result=result.replace(/\s\+\s\)$/g,")"))),result}},formatEnginePowerCombinedKw:function(fomPower1Kw,fomPower2Kw){if(fomPower1Kw||fomPower2Kw){var format=Util.getMDSyncFormat(["UI_FORMAT"],"format.text.enginePowerCombinedKw"),result=GeneralRules.format(format,{power1Kw:fomPower1Kw,power2Kw:fomPower2Kw});return result=result?result.replace(/^\s\+\s/g,""):result}},formatEnginePowerCombinedHp:function(fomPower1Hp,fomPower2Hp){if(fomPower1Hp||fomPower2Hp){var format=Util.getMDSyncFormat(["UI_FORMAT"],"format.text.enginePowerCombinedHp"),result=GeneralRules.format(format,{power1Hp:fomPower1Hp,power2Hp:fomPower2Hp});return result=result?result.replace(/^\s\+\s/g,""):result}},formatTDVSFromTValue:function(item){var result,value=item?item.value:void 0;if(void 0===value||""===value.trim())return result;var itemID=item.id,valueFormatConfig=Util.getMDSyncFormat(["UI_FORMAT"],"format.number.tdvs."+itemID),textFormatConfig=Util.getMDSyncFormat(["UI_FORMAT"],"format.text.tdvs."+itemID);if(valueFormatConfig&&(value=GeneralRules.formatNum(valueFormatConfig,value)),textFormatConfig)result=GeneralRules.format(textFormatConfig,{value:value});else{var unit=item.unit;result=unit?value+" "+unit:value}return result}}}]),angular.module("base.jsif").factory("GeoSuggestService",["HttpService","ContextService","ConfigService","BASE_API_GEO_SUGGEST_URL",function(HttpService,ContextService,ConfigService,BASE_API_GEO_SUGGEST_URL){var lastBaseStatus={};return{getGeoSuggestions:function(searchTerm,maxSuggestions){var context=ContextService.getContext(),baseUrl=ConfigService.getBaseApiURL(BASE_API_GEO_SUGGEST_URL),url=baseUrl+"/"+context.countryCode+"/"+context.language+"/"+context.processId+"/"+encodeURIComponent(searchTerm);maxSuggestions&&(url+="?maxSuggestions="+maxSuggestions);var httpMethod=HttpService.get({fullUrl:url});return httpMethod.then(function(geoSuggestResponse){return lastBaseStatus=geoSuggestResponse.baseStatus,geoSuggestResponse||{}})}}}]),angular.module("base.jsif").factory("HttpService",["ContextService","UtilsService","$http","$q","HTTP_CONFIG","USE_CURRENT_HOST","IS_TESTING",function(ContextService,UtilsService,$http,$q,HTTP_CONFIG,USE_CURRENT_HOST,IS_TESTING){var _timestamp,_jsifInitError,CONTENT_TYPE_GENERIC=0,CONTENT_TYPE_JSON=1,CONTENT_TYPE_BINARY=2,VERSION="1.0",buildContext=function(context,isBasicForm){if(!context)return{};var result={processId:context.processId,locale:context.language+"_"+context.countryCode,userId:context.userId,sessionId:context.sessionId,timestamp:context.timestamp};return!angular.isUndefined(isBasicForm)&&isBasicForm||(result.companyId=context.companyId,result.outletIds=context.outletIds,result.uiId=context.uiId),result},getRequestConfig=function(){var requestConfig={timeout:HTTP_CONFIG.timeout};return requestConfig},buildPdfExportUrl=function(vehicleId,financialDigest){return vehicleId||(vehicleId=0),financialDigest||(financialDigest=0),"/"+vehicleId+"/"+financialDigest},buildUrl=function(urlComponents){urlComponents=urlComponents?urlComponents:{},urlComponents.filename=urlComponents.filename?"_"+urlComponents.filename:"",urlComponents.resource=urlComponents.resource||"";var serviceUrl="",context=ContextService.getContext(),isTDVSRequest=!!urlComponents.resource&&urlComponents.resource.indexOf("/tdvs")>-1;urlComponents.vehicleId&&!isTDVSRequest?serviceUrl=buildPdfExportUrl(urlComponents.vehicleId,urlComponents.financialDigest):urlComponents.resource.indexOf("/cf")>-1&&(serviceUrl="/"+context.uiId);var endpoint="",isSearchAgentRequest=urlComponents.resource.indexOf("/searchagent")>-1||urlComponents.resource.indexOf("/sab")>-1,isRetailerRequest=urlComponents.resource.indexOf("/retailer")>-1,isV2Request=urlComponents.resource.indexOf("/v2")>-1;if(isV2Request){var extendedEnpoint=urlComponents.endpoint?"/"+urlComponents.endpoint:"",searchType=urlComponents.searchType?"/"+urlComponents.searchType:"";endpoint="/"+context.processId+"/"+context.countryCode+searchType+extendedEnpoint}else isTDVSRequest&&urlComponents.vehicleId?endpoint="/"+context.processId+"/"+context.language+"_"+context.countryCode+"/"+urlComponents.vehicleId:isRetailerRequest?endpoint="/"+context.countryCode+"/"+context.processId+"/"+context.retailerId:isSearchAgentRequest||isTDVSRequest||(endpoint="/base_"+context.processId+"_"+context.language+"_"+context.countryCode,
context.userId&&(endpoint+=encodeURIComponent("."+context.userId+"_"+context.sessionId+"_"+context.timestamp)));urlComponents.vehicleId&&!isTDVSRequest?endpoint+=".pdf":isSearchAgentRequest||isV2Request||isTDVSRequest||(endpoint+=urlComponents.filename+".json");var computedUrl=urlComponents.resource+serviceUrl+endpoint;return computedUrl},computeWebHost=function(){var PROTOCOL=window.location.protocol+"//",HOSTNAME=window.location.hostname,CURRENT_HOST=PROTOCOL+HOSTNAME;if(!IS_TESTING){var PORT=window.location.port?":"+window.location.port:"";CURRENT_HOST+=PORT}return CURRENT_HOST},getUrlForContextMode=function(fullUrl){return fullUrl?fullUrl:null},getLocalPathForContextMode=function(localPath){return localPath?localPath:null},handleHTTPError=function(error,url){var errorResponse={};if(_jsifInitError)errorResponse.jsifStatus=_jsifInitError;else switch(error.status){case 0:errorResponse.jsifStatus={code:error.status.toString(),text:"Timeout when accessing BASE server",url:url};break;case 404:errorResponse.jsifStatus={code:error.status.toString(),text:"Page not found",url:url},errorResponse.baseStatus={code:error.status.toString(),text:"Page not found",url:url};break;case 423:errorResponse.jsifStatus={code:error.status.toString(),text:"The feature is currently not enabled for this market.",url:url},errorResponse.baseStatus={code:error.status.toString(),text:"The feature is currently not enabled for this market.",url:url};break;case 500:errorResponse.jsifStatus={code:error.status.toString(),text:"Server error",url:url};break;default:errorResponse.jsifStatus={code:"200",text:"OK"},error.data?errorResponse.baseStatus=error.data:errorResponse.baseStatus={code:"501",text:error.statusText?error.statusText:error.toString()},errorResponse.baseStatus.url=url}return errorResponse},handleHTTPResponse=function(response,contentType){var result;if(!response)return result;if(result={},response.data.sessionResponse)result.sessionResponse=response.data.sessionResponse;else if(response.data.searchAgents)result.searchAgents=response.data.searchAgents;else if(response.data.quantity)result.quantity=response.data.quantity;else if(response.data.VehicleMDResponse)result.vehicleMDResponse=response.data.VehicleMDResponse;else if(response.data.byteLength||contentType===CONTENT_TYPE_BINARY){var content=contentType===CONTENT_TYPE_BINARY?response.data:UtilsService.convertToUTF8(new Uint8Array(response.data));result._version=VERSION,result.content=contentType===CONTENT_TYPE_JSON?JSON.parse(content):content}else{_jsifInitError?result.jsifStatus=_jsifInitError:result.jsifStatus={code:"200",text:"OK"};var responseData={};responseData=response.data.vehicleSearchResponse?response.data.vehicleSearchResponse:response.data.PropertySuggestResponse?response.data.PropertySuggestResponse:response.data,result.baseStatus=responseData.statusInfo?responseData.statusInfo.status:null,result.token=responseData.token,result.version=responseData.version,result.results=responseData.results,result.vehicles=responseData.vehicles,result.suggest=responseData.suggest,result.suggestions=responseData.suggestions,result.context=responseData.context,result.uiInfo=responseData.uiInfo,result.data=responseData.data}return result};return{get:function(urlComponents,params,responseType){if(_jsifInitError){var deferred=$q.defer(),result={};return result.jsifStatus=_jsifInitError,deferred.resolve(result),deferred.promise}var computedUrl="",config=getRequestConfig();return params&&(config.params=params),responseType&&(config.responseType=responseType),urlComponents&&(computedUrl=urlComponents.fullUrl?getUrlForContextMode(urlComponents.fullUrl):urlComponents.localPath?getLocalPathForContextMode(urlComponents.localPath):buildUrl(urlComponents)),$http.get(computedUrl,config).then(function(response){var contentType=urlComponents&&urlComponents.contentIsJson?CONTENT_TYPE_JSON:CONTENT_TYPE_GENERIC;return handleHTTPResponse(response,contentType)},function(error){return handleHTTPError(error,computedUrl)})},put:function(urlComponents,data){if(_jsifInitError){var deferred=$q.defer(),result={};return result.jsifStatus=_jsifInitError,deferred.resolve(result),deferred.promise}var computedUrl="",config=getRequestConfig();return computedUrl=buildUrl(urlComponents),$http.put(computedUrl,data,config).then(function(response){var contentType=urlComponents&&urlComponents.contentIsJson?CONTENT_TYPE_JSON:CONTENT_TYPE_GENERIC;return handleHTTPResponse(response,contentType)},function(error){return handleHTTPError(error,computedUrl)})},"delete":function(urlComponents){if(_jsifInitError){var deferred=$q.defer(),result={};return result.jsifStatus=_jsifInitError,deferred.resolve(result),deferred.promise}var computedUrl="",config=getRequestConfig();return computedUrl=buildUrl(urlComponents),$http["delete"](computedUrl,config).then(function(response){var contentType=urlComponents&&urlComponents.contentIsJson?CONTENT_TYPE_JSON:CONTENT_TYPE_GENERIC;return handleHTTPResponse(response,contentType)},function(error){return handleHTTPError(error,computedUrl)})},postSync:function(urlComponents,data,storeTimestamp){if(_jsifInitError)return{jsifStatus:_jsifInitError};var computedUrl="",isTDVSRequest=!1;urlComponents&&(isTDVSRequest=urlComponents.resource.indexOf("/tdvs")>-1,computedUrl=buildUrl(urlComponents));var context=ContextService.getContext();isTDVSRequest?data.context=buildContext(context,!0):data&&data.mdConfigRequest&&(data.mdConfigRequest.context=buildContext(context));var xhr=new XMLHttpRequest;if(xhr.open("POST",computedUrl,!1),xhr.setRequestHeader("Content-type","application/json"),xhr.send(angular.toJson(data)),200!==xhr.status){var error={status:xhr.status};return xhr.responseText.baseStatus||(error.data={code:xhr.status,text:xhr.responseText}),handleHTTPError(error,computedUrl)}storeTimestamp&&(_timestamp=xhr.getResponseHeader("Date"));var response=xhr.responseText;return handleHTTPResponse({data:JSON.parse(response)})},getSync:function(urlComponents,storeTimestamp){if(_jsifInitError)return{jsifStatus:_jsifInitError};var computedUrl="";urlComponents&&(computedUrl=buildUrl(urlComponents));var xhr=new XMLHttpRequest;if(xhr.open("GET",computedUrl,!1),xhr.send(null),200!==xhr.status){var error={status:xhr.status};return xhr.responseText.baseStatus||(error.data={code:xhr.status,text:xhr.responseText}),handleHTTPError(error,computedUrl)}storeTimestamp&&(_timestamp=xhr.getResponseHeader("Date"));var response=xhr.responseText;return handleHTTPResponse({data:JSON.parse(response)})},generateInvalidResponse:function(expectedResponse){var deferred=$q.defer(),result={};return result.jsifStatus=expectedResponse||{code:"503"},deferred.resolve(result),deferred.promise},post:function(urlComponents,data,responseType){if(_jsifInitError){var deferred=$q.defer(),result={};return result.jsifStatus=_jsifInitError,deferred.resolve(result),deferred.promise}data=data?data:{};var dataHasVehicleSearchRequest=data&&data.vehicleSearchRequest,computedUrl="",config=getRequestConfig(),context=ContextService.getContext();responseType&&(config.responseType=responseType);var isTDVSRequest=!1;if(urlComponents){isTDVSRequest=urlComponents.resource.indexOf("/tdvs")>-1;var requestedData=dataHasVehicleSearchRequest?data.vehicleSearchRequest:data;computedUrl=buildUrl(urlComponents,requestedData)}return isTDVSRequest?data.context=buildContext(context,!0):dataHasVehicleSearchRequest?data.vehicleSearchRequest.context=buildContext(context):data.PropertySuggestRequest?data.PropertySuggestRequest.context=buildContext(context):data.VehicleMDRequest?data.VehicleMDRequest.context=buildContext(context):data.searchAgentMaintenanceRequest||(data.context=buildContext(context)),$http.post(computedUrl,data,config).then(function(response){var contentType="arraybuffer"===responseType?CONTENT_TYPE_BINARY:CONTENT_TYPE_GENERIC;return handleHTTPResponse(response,contentType)},function(error){return handleHTTPError(error,computedUrl)})},submitForm:function(urlComponents,data){if(!_jsifInitError){var computedUrl="",context=ContextService.getContext();if(data=data?data:{},urlComponents){var dataToSend=data.vehicleSearchRequest?data.vehicleSearchRequest:data;computedUrl=buildUrl(urlComponents,dataToSend)}data.vehicleSearchRequest?data.vehicleSearchRequest.context=buildContext(context):data.context=buildContext(context);var form=document.getElementById("pdfExport");form||(form=document.createElement("form"),form.setAttribute("method","POST"),form.setAttribute("id","pdfExport")),form.setAttribute("action",computedUrl);var input=document.getElementById("pdfExportInput");input||(input=document.createElement("input"),input.setAttribute("type","hidden"),input.setAttribute("name","pdf"),input.setAttribute("id","pdfExportInput")),input.setAttribute("value",JSON.stringify(data)),form.appendChild(input),document.body.appendChild(form),form.submit()}},buildURLFromConfig:function(configURL){var CURRENT_HOST=computeWebHost(),result=configURL,regex=new RegExp("http[s]?");if(regex.test(configURL)){if(USE_CURRENT_HOST){var hostRegex=new RegExp("^http[s]?://[^/]+");result=configURL.replace(hostRegex,CURRENT_HOST)}}else 0!==configURL.indexOf("/")&&(configURL="/"+configURL),result=CURRENT_HOST+configURL;return result},getCurrentYear:function(){var parsedTimestamp=UtilsService.parseTimestamp(_timestamp);return parsedTimestamp?parsedTimestamp.year:void 0},validateInitResponse:function(response){response&&response.baseStatus&&void 0!==response.baseStatus.code&&(response.baseStatus.code<200||response.baseStatus.code>299)&&(_jsifInitError={},_jsifInitError.url=response.baseStatus.url,_jsifInitError.code="502",_jsifInitError.text="Failed to initialize JSIF.")},computeHost:function(){return computeWebHost()},resetJsifInitError:function(){_jsifInitError=null}}}]),angular.module("base.jsif").factory("I18NService",["MasterDataService","ContextService","UtilsService",function(MasterDataService,ContextService,UtilsService){var i18nType="UI_I18N",INVALID_LANGUAGE_FORMAT='Language must respect the format: "xx", where x is a letter from a-z.';return{getTranslations:function(){return MasterDataService.getMD([i18nType]).then(function(translations){var result={};return translations?(translations.results&&translations.results.UI_I18N&&(result=translations.results.UI_I18N),result.baseStatus=translations.baseStatus,result.jsifStatus=translations.jsifStatus,UtilsService.log("I18N RESPONSE:\n %s",result),result):result})},getTranslationsSync:function(){var translations=MasterDataService.getMDSync([i18nType]),result={};return translations?(translations.results&&translations.results.UI_I18N&&(result=translations.results.UI_I18N),result.baseStatus=translations.baseStatus,result.jsifStatus=translations.jsifStatus,UtilsService.log("I18N RESPONSE:\n %s",result),result):result},setLanguage:function(language){if(language){if(2!==language.length)throw INVALID_LANGUAGE_FORMAT;ContextService.getContext().language=language,MasterDataService.removeMD(i18nType),MasterDataService.getMD([i18nType])}},getLastBaseStatus:function(){return MasterDataService.getLastBaseStatus()}}}]),angular.module("base.jsif").factory("JsifMainService",["ContextService","ConfigService","MasterDataService","I18NService","HttpService",function(ContextService,ConfigService,MasterDataService,I18NService,HttpService){function init(countryCode,processId,language,uiId,company,outletIds,offline,userId,sessionId,timestamp){initJsif(countryCode,processId,language,uiId,company,outletIds,userId,sessionId,timestamp)}function initJsif(countryCode,processId,language,uiId,company,outletIds,userId,sessionId,timestamp){var context={countryCode:countryCode,processId:processId,language:language,uiId:uiId,companyId:company,outletIds:outletIds,userId:userId,sessionId:sessionId,timestamp:timestamp};outletIds?angular.isArray(outletIds.outletId)?context.outletIds=outletIds.outletId:outletIds.outletId&&(context.outletIds=[outletIds.outletId]):context.outletIds=[],ContextService.setContext(context);var response=ConfigService.getConfigSync();HttpService.validateInitResponse(response);var config=ConfigService.getInternalConfig("ui.initialMasterdata"),mdTypes=config?config.split(/[,\s]+/g).sort():[];MasterDataService.emptyMDCache(),response=MasterDataService.getMDSync(mdTypes),HttpService.validateInitResponse(response),response=I18NService.getTranslationsSync(),HttpService.validateInitResponse(response)}function initJsifWithSessionId(sessionId){return ConfigService.getSessionRequest(sessionId).then(function(response){var result={},storedResponse=localStorage[sessionId];return storedResponse&&(response=JSON.parse(storedResponse)),response&&response.sessionRequest?(response.uiId="main",initJsif(response.sessionRequest.country,response.sessionRequest.processId,response.sessionRequest.language,response.uiId,"",response.sessionRequest.outletIds,response.sessionRequest.userId,response.sessionId,response.timestamp),result.jsifStatus={code:200,text:"OK"},localStorage[sessionId]=JSON.stringify(response)):response&&response.statusInfo?result.jsifStatus=response.statusInfo:result.jsifStatus={code:502,text:"Failed to initialize JSIF. The session service is not available."},result})}function initWithRetailerId(retailerId,countryCode,processId,language,uiId,userId,sessionId,timestamp){var context={retailerId:retailerId,countryCode:countryCode,processId:processId,language:language,uiId:uiId,userId:userId,sessionId:sessionId,timestamp:timestamp};ContextService.setContext(context);var response=ConfigService.getRetailerConfigSync();if(HttpService.validateInitResponse(response),response&&response.context){var retailerOutletId,retailerCompany=response.context.companyIds,outletIds=response.context.outletIds;outletIds&&(outletIds=outletIds.replace(/[\s\[\]]/g,""),retailerOutletId=outletIds.split(",")),init(countryCode,processId,language,uiId,retailerCompany,retailerOutletId,!1,userId,sessionId,timestamp)}else HttpService.resetJsifInitError(),init(countryCode,processId,language,uiId,null,null,!1,userId,sessionId,timestamp)}return{init:init,initJsif:initJsif,initJsifWithSessionId:initJsifWithSessionId,initWithRetailerId:initWithRetailerId}}]),angular.module("base.jsif").factory("MasterDataService",["HttpService","ConfigService","$q","BASE_API_MASTERDATA_URL",function(HttpService,ConfigService,$q,BASE_API_MASTERDATA_URL){var lastBaseStatus={},masterData={},buildStoredMDResponse=function(masterData,types){var results={};return types&&types.length?types.forEach(function(t){masterData[t]&&(results[t]=masterData[t])}):results=masterData,{baseStatus:{code:"200",text:"OK"},jsifStatus:{code:"200",text:"OK"},results:results,_version:"1.0"}},generateMasterDataResponse=function(response,mdTypes){var masterDataResponse={baseStatus:response.baseStatus,jsifStatus:response.jsifStatus,_version:response.version},results=response.results||{};return mdTypes&&mdTypes.forEach(function(type){masterData[type]&&(results[type]=masterData[type])}),masterDataResponse.results=results,masterDataResponse};return{getMD:function(types){types=void 0!==types?types:[];var mdKeys=Object.keys(masterData),unknownTypes=types.filter(function(el){return mdKeys.indexOf(el)<0}),url=ConfigService.getBaseApiURL(BASE_API_MASTERDATA_URL);if(!types.length||!unknownTypes.length){var deferred=$q.defer(),retrievedMasterData=buildStoredMDResponse(masterData,types);return deferred.resolve(retrievedMasterData),deferred.promise}var mdConfigRequest={mdConfigRequest:{types:types}};return HttpService.post({resource:url},mdConfigRequest).then(function(response){response&&response.results&&unknownTypes.forEach(function(u){masterData[u]=response.results[u]||{}}),lastBaseStatus=response.baseStatus;var retrievedMasterData=generateMasterDataResponse(response,types);return retrievedMasterData})},getMDSync:function(types){types=void 0!==types?types:[];var mdKeys=Object.keys(masterData),unknownTypes=types.filter(function(el){return mdKeys.indexOf(el)<0}),url=ConfigService.getBaseApiURL(BASE_API_MASTERDATA_URL);if(!types.length||!unknownTypes.length)return buildStoredMDResponse(masterData,types);var mdConfigRequest={mdConfigRequest:{types:types}},response=HttpService.postSync({resource:url},mdConfigRequest);response&&response.results&&unknownTypes.forEach(function(u){masterData[u]=response.results[u]||{}}),lastBaseStatus=response.baseStatus;var retrievedMasterData=generateMasterDataResponse(response,types);return retrievedMasterData},removeMD:function(type){delete masterData[type]},getLastBaseStatus:function(){return lastBaseStatus},emptyMDCache:function(){var emptyObject={};angular.copy(emptyObject,masterData)}}}]),angular.module("base.jsif").factory("PropSuggestService",["HttpService","ConfigService","BASE_API_PROP_SUGGEST_URL",function(HttpService,ConfigService,BASE_API_PROP_SUGGEST_URL){var lastBaseStatus={};return{searchPropSuggest:function(searchRequest){var url=ConfigService.getBaseApiURL(BASE_API_PROP_SUGGEST_URL),httpMethod=HttpService.post({resource:url,kind:"propSuggest"},searchRequest);return httpMethod.then(function(searchResponse){return lastBaseStatus=searchResponse.baseStatus,searchResponse})}}}]),angular.module("base.jsif").factory("SearchAgentService",["HttpService","ContextService","ConfigService","BASE_API_SEARCHAGENT_URL","BASE_API_SEARCHAGENT_BATCH_URL",function(HttpService,ContextService,ConfigService,BASE_API_SEARCHAGENT_URL,BASE_API_SEARCHAGENT_BATCH_URL){function createSearchAgentRequest(searchAgent){var result={};return result.searchAgentMaintenanceRequest={},result.searchAgentMaintenanceRequest.name=searchAgent.name,result.searchAgentMaintenanceRequest.createdAt=searchAgent.createdAt,result.searchAgentMaintenanceRequest.description=searchAgent.description,result.searchAgentMaintenanceRequest.activated=searchAgent.activated,result.searchAgentMaintenanceRequest.email=searchAgent.email,result.searchAgentMaintenanceRequest.notify=searchAgent.notify,result.searchAgentMaintenanceRequest.criteriaVersion=searchAgent.criteriaVersion,result.searchAgentMaintenanceRequest.criteria=searchAgent.criteria,result.searchAgentMaintenanceRequest.activatedLifetime=searchAgent.activatedLifetime,result}return{countActiveSearchAgentsByContext:function(){var context=ContextService.getContext(),host=ConfigService.getBaseApiURL(BASE_API_SEARCHAGENT_URL),outletId=context.outletIds&&context.outletIds.length?context.outletIds[0]:null,url=host+"/countActive/"+context.countryCode+"/"+context.processId+"/"+context.language+"/"+outletId+"/"+context.userId+"/"+encodeURIComponent(context.timestamp)+"/"+context.sessionId,httpMethod=HttpService.get({resource:url});return httpMethod.then(function(searchResponse){return searchResponse||{}})},getSearchAgentsByContext:function(){var context=ContextService.getContext(),host=ConfigService.getBaseApiURL(BASE_API_SEARCHAGENT_URL),outletId=context.outletIds&&context.outletIds.length?context.outletIds[0]:null,url=host+"/"+context.countryCode+"/"+context.processId+"/"+context.language+"/"+outletId+"/"+context.userId+"/"+encodeURIComponent(context.timestamp)+"/"+context.sessionId,httpMethod=HttpService.get({resource:url});return httpMethod.then(function(searchResponse){return searchResponse||{}})},getActiveAndSuccessfulSearchAgentsByContext:function(){var context=ContextService.getContext(),host=ConfigService.getBaseApiURL(BASE_API_SEARCHAGENT_URL),outletId=context.outletIds&&context.outletIds.length?context.outletIds[0]:null,url=host+"/active/"+context.countryCode+"/"+context.processId+"/"+context.language+"/"+outletId+"/"+context.userId+"/"+encodeURIComponent(context.timestamp)+"/"+context.sessionId,httpMethod=HttpService.get({resource:url});return httpMethod.then(function(searchResponse){return searchResponse||{}})},getSearchAgentById:function(searchAgentId){var context=ContextService.getContext(),host=ConfigService.getBaseApiURL(BASE_API_SEARCHAGENT_URL),outletId=context.outletIds&&context.outletIds.length?context.outletIds[0]:null,url=host+"/"+context.countryCode+"/"+context.processId+"/"+context.language+"/"+outletId+"/"+context.userId+"/"+encodeURIComponent(context.timestamp)+"/"+context.sessionId+"/"+searchAgentId,httpMethod=HttpService.get({resource:url});return httpMethod.then(function(searchResponse){return searchResponse||{}})},createSearchAgent:function(searchAgent){var context=ContextService.getContext(),host=ConfigService.getBaseApiURL(BASE_API_SEARCHAGENT_URL),outletId=context.outletIds&&context.outletIds.length?context.outletIds[0]:null,url=host+"/"+context.countryCode+"/"+context.processId+"/"+context.language+"/"+outletId+"/"+context.userId+"/"+encodeURIComponent(context.timestamp)+"/"+context.sessionId;searchAgent.criteriaVersion=1;var request=createSearchAgentRequest(searchAgent),httpMethod=HttpService.post({resource:url},request);return httpMethod.then(function(response){return response||{}})},updateSearchAgent:function(searchAgent){var context=ContextService.getContext(),host=ConfigService.getBaseApiURL(BASE_API_SEARCHAGENT_URL),outletId=context.outletIds&&context.outletIds.length?context.outletIds[0]:null,url=host+"/"+context.countryCode+"/"+context.processId+"/"+context.language+"/"+outletId+"/"+context.userId+"/"+encodeURIComponent(context.timestamp)+"/"+context.sessionId+"/"+searchAgent.id;searchAgent.criteriaVersion=1;var request=createSearchAgentRequest(searchAgent),httpMethod=HttpService.put({resource:url},request);return httpMethod.then(function(response){return response||{}})},executeSearchAgents:function(searchAgentIds){if(searchAgentIds){for(var context=ContextService.getContext(),host=ConfigService.getBaseApiURL(BASE_API_SEARCHAGENT_BATCH_URL),outletId=context.outletIds&&context.outletIds.length?context.outletIds[0]:null,url=host+"/run/"+context.countryCode+"/"+context.processId+"/"+context.language+"/"+outletId+"/"+context.userId+"/"+encodeURIComponent(context.timestamp)+"/"+context.sessionId,index=0;index<searchAgentIds.length;index++)url=url+"/"+searchAgentIds[index];var httpMethod=HttpService.get({resource:url});return httpMethod.then(function(response){return response||{}})}},updateActivateSearchAgents:function(searchAgents,activate){for(var httpMethod,context=ContextService.getContext(),host=ConfigService.getBaseApiURL(BASE_API_SEARCHAGENT_URL),outletId=context.outletIds&&context.outletIds.length?context.outletIds[0]:null,url=host+"/"+context.countryCode+"/"+context.processId+"/"+context.language+"/"+outletId+"/"+context.userId+"/"+encodeURIComponent(context.timestamp)+"/"+context.sessionId,i=0;i<searchAgents.length;i++){var searchAgentUrl=url+"/"+searchAgents[i].id;searchAgents[i].activated=activate;var request=createSearchAgentRequest(searchAgents[i]);httpMethod=HttpService.put({resource:searchAgentUrl},request)}return httpMethod.then(function(searchResponse){return searchResponse||{}})},deleteSearchAgents:function(searchAgentIds){for(var promise,context=ContextService.getContext(),host=ConfigService.getBaseApiURL(BASE_API_SEARCHAGENT_URL),outletId=context.outletIds&&context.outletIds.length?context.outletIds[0]:null,url=host+"/"+context.countryCode+"/"+context.processId+"/"+context.language+"/"+outletId+"/"+context.userId+"/"+encodeURIComponent(context.timestamp)+"/"+context.sessionId,i=0;i<searchAgentIds.length;i++){var searchAgentUrl=url+"/"+searchAgentIds[i];promise=HttpService["delete"]({resource:searchAgentUrl})}return promise.then(function(searchResponse){return searchResponse||{}})}}}]),angular.module("base.jsif").factory("TDVSService",["HttpService","ConfigService","ContextService","$q","BASE_API_TDVS_URL",function(HttpService,ConfigService,ContextService,$q,BASE_API_TDVS_URL){function getTDVSDataAsync(id){if(!id||angular.isArray(id)){var deferred=$q.defer();return deferred.resolve([]),deferred.promise}var response,context=ContextService.getContext();if(context&&context.sessionId)response=getMultipleTDVSDataAsync([id]).then(function(result){return result.length?[result[0]]:result});else{var host=ConfigService.getBaseApiURL(BASE_API_TDVS_URL),url=host+"/vehicles";response=HttpService.get({resource:url,vehicleId:id}).then(function(result){return result.data})}return response}function getTDVSData(id){var tdvsData={values:[]};if(!id||angular.isArray(id))return tdvsData;var context=ContextService.getContext(),result=null;if(context&&context.sessionId)result=getMultipleTDVSData([id]),result.values.length&&(result=result.values[0]);else{var host=ConfigService.getBaseApiURL(BASE_API_TDVS_URL),url=host+"/vehicles";result=HttpService.getSync({resource:url,vehicleId:id}),result&&result.data&&result.data.length&&(result=result.data[0])}return result&&result.parameters&&(tdvsData.values=result.parameters.values),tdvsData}function getMultipleTDVSData(ids){var tdvsData={values:[]};if(!ids||!angular.isArray(ids))return tdvsData;var host=ConfigService.getBaseApiURL(BASE_API_TDVS_URL),url=host+"/vehicles",result=HttpService.postSync({resource:url},{ids:ids});return result&&result.data&&result.data[0]&&result.data[0].parameters&&(tdvsData.values=result.data),tdvsData}function getMultipleTDVSDataAsync(ids){if(!ids||!angular.isArray(ids)){var deferred=$q.defer();return deferred.resolve([]),deferred.promise}var host=ConfigService.getBaseApiURL(BASE_API_TDVS_URL),url=host+"/vehicles";return HttpService.post({resource:url},{ids:ids}).then(function(result){return result.data})}return{getTDVSData:getTDVSData,getTDVSDataAsync:getTDVSDataAsync,getMultipleTDVSData:getMultipleTDVSData,getMultipleTDVSDataAsync:getMultipleTDVSDataAsync}}]),angular.module("base.jsif").factory("UIService",["VehSearchService","PropSuggestService","ConfigService","UtilsService","FOMMapperService","FOMRulesService","MasterDataService","GeoSuggestService","TDVSService","$q","EMULATE_PAINTTYPE_CODETEXT_FACET",function(VehSearchService,PropSuggestService,ConfigService,UtilsService,FOMMapperService,FOMRulesService,MasterDataService,GeoSuggestService,TDVSService,$q,EMULATE_PAINTTYPE_CODETEXT_FACET){function updateEquipmentGroupFacetWithCategoryInfo(equipmentGroupFacet,equipmentCategoriesToGroupCode,equipmentCategoriesMasterData){for(var categoryCode=null,categoryText=null,categoryPosition=null,categoriesToGroupCodeKeys=Object.keys(equipmentCategoriesToGroupCode),k=0;k<equipmentGroupFacet.code.length;k++){for(var equipmentGroupFacetCode=equipmentGroupFacet.code[k],i=0;i<categoriesToGroupCodeKeys.length;i++){var categoryKey=categoriesToGroupCodeKeys[i],categoryGroups=equipmentCategoriesToGroupCode[categoryKey];if(categoryGroups.indexOf(equipmentGroupFacetCode)>-1){categoryCode=categoryKey,categoryText=equipmentCategoriesMasterData&&equipmentCategoriesMasterData[categoryKey]?equipmentCategoriesMasterData[categoryKey]:null,categoryPosition=i;break}}if(categoryCode)break}equipmentGroupFacet.categoryCode=categoryCode,equipmentGroupFacet.categoryText=categoryText,equipmentGroupFacet.categoryPosition=categoryPosition}function enrichFacetsResponse(response,requestFacets){response.facets=[];for(var resultsLength=response.results.length,k=0;k<resultsLength;k++){var resultResponse=response.results[k];if(resultResponse.facets){var updatedFacets=_FACETS.map(requestFacets,resultResponse.facets);response.facets=response.facets.concat(updatedFacets)}}}function enrichCriteriaResponse(response,requestFacets,requestSearchInfo){response.vehicles=[],response.facets=[],response.count=0;for(var resultsLength=response.results.length,j=0;j<resultsLength;j++){var responseResult=response.results[j],summary=responseResult.summary;if(responseResult.vehicles){var fomVehicle=_CONVERTER.toFOM(responseResult.vehicles);response.vehicles=response.vehicles.concat(fomVehicle)}if(summary&&void 0!==summary.totalQuantity&&(response.count+=summary.totalQuantity),responseResult.facets){var enrichedFacets=_FACETS.map(requestFacets,responseResult.facets);response.facets=response.facets.concat(enrichedFacets)}}if(response.vehicles.length||delete response.vehicles,response.facets.length||delete response.facets,requestSearchInfo&&resultsLength>0){var resultSummary=response.results[0].summary;if(resultSummary){var totalQuantity=resultSummary.totalQuantity,configPaging=ConfigService.getInternalConfig(_CONFIG_PAGING_MAX_VEHICLES),configVehicles=parseInt(configPaging,10),vehiclesPerPage=configVehicles||totalQuantity||_DEFAULT_VEHICLES_PER_PAGE,requestQuantity=requestSearchInfo.paging?new Number(requestSearchInfo.paging.quantity):configVehicles||_DEFAULT_VEHICLES_PER_PAGE;response.searchInfo.paging={},response.searchInfo.paging.currentPage=resultSummary.pageIndex+1,response.searchInfo.paging.vehiclesPerPage=vehiclesPerPage,response.searchInfo.paging.pageCount=Math.ceil(totalQuantity/requestQuantity)}}response.countText=FOMRulesService.formatNumberGeneral(response.count)}function enrichCategoryResponse(response,requestFacets){for(var resultsLength=response.results.length,i=0;i<resultsLength;i++){var result=response.results[i],cat=result.category;cat&&(response.categories[cat]={},result.vehicles&&(response.categories[cat].vehicles=_CONVERTER.toFOM(result.vehicles)),result.summary&&void 0!==result.summary.totalQuantity&&(response.categories[cat].count=result.summary.totalQuantity,response.categories[cat].countText=FOMRulesService.formatNumberGeneral(response.categories[cat].count)),result.facets&&(response.categories[cat].facets=_FACETS.map(requestFacets,result.facets)))}}var _CODE_ARRAY_CRITERIA=["availability","bodyGroup","bodyGroupSalesClassMap","brand","currentSalesModel","engineType","equipment","equipmentGroup","firstVehicleUsage","fuelType","lengthGroup","genericStr0","genericStr1","genericStr2","genericStr3","genericStr4","genericStr5","genericStr6","genericStr7","genericStr8","genericStr9","licenseState","line","onlineSales","orderStatus","paintGroup","paintPrimary","paintPrimaryGroup","paintSecondary","paintSecondaryGroup","salesClass","salesClassBodyGroupDrive","salesProgram","status","stockCategory","transmissionType","upholstery","upholsteryColorGroup","upholsteryType","vehicleCategory"],_CONFIG_PAGING_MAX_VEHICLES="ui.search.paging.maxVehicles",_CONFIG_RETRIEVE_DEALER_HIERARCHY="sync.vehicle.retrieveDealerHierarchy",_CONFIG_EQUIPMENT_CAT_TO_GROUP_CODE="equipmentCategoriesToGroupCode",_EQUIPMENT_CAT_MD_TYPE="EQUIPMENT_CAT",_PAINT_TYPE_KEY="PAINT_TYPE",_FRONTEND_DATE_FORMAT="MM/YYYY",_BACKEND_DATE_FORMAT="YYYYMMDD",_FALLBACK_DATE_FORMAT="MM/DD/YYYY",_VERSION="1.0",_DEFAULT_VEHICLES_PER_PAGE=10,_UI_CONFIG_FIELD_MAPPING={invoiceToDealerDate:"wholesaleInvoiceDate",deliveryDate:"targetDeliveryDate"},_CONVERTER={toBackendDate:function(date,configKey,rangeKey,setToLastDayOfMonth){if(date){if(date.match(/^[0-9]*$/g))return date;var uiFields=ConfigService.getUIFields(),format=_FALLBACK_DATE_FORMAT;if(uiFields){var uiConfigKey=_UI_CONFIG_FIELD_MAPPING[configKey]||configKey,fieldsConfig=uiFields[uiConfigKey+rangeKey];fieldsConfig&&fieldsConfig.dateFormat&&(format=fieldsConfig.dateFormat.toUpperCase())}var formattedDate=window.moment(date,format);formattedDate.isValid()||(formattedDate=window.moment(date,_BACKEND_DATE_FORMAT));var dateComponents=date.split(/[\/\.-]/);return 2===dateComponents.length&&(formattedDate=setToLastDayOfMonth?formattedDate.endOf("month"):formattedDate.startOf("month")),formattedDate=formattedDate.format(_BACKEND_DATE_FORMAT)}},toFrontendDate:function(date){if(date){var formattedDate=window.moment(date,_BACKEND_DATE_FORMAT).format(_FRONTEND_DATE_FORMAT);return formattedDate}},toBackendMinMaxDate:function(criterion,inputName){criterion&&(criterion.min=this.toBackendDate(criterion.min,inputName,"To"),criterion.max=this.toBackendDate(criterion.max,inputName,"From",!0))},toFOM:function(bomVehicles){if(!bomVehicles)return[];var fomVehicles=[];return bomVehicles.forEach(function(vehicle){var mappedVehicle=FOMMapperService.mapBOMToFOM(vehicle);fomVehicles.push(mappedVehicle)}),fomVehicles}},_FACETS={_FIRST_REG_DATE:"firstRegistrationDate",_FINAL_INSP_DATE:"finalInspectionDate",_BGSCMAP:"bodyGroupSalesClassMap",_SCBGDRIVE:"salesClassBodyGroupDrive",_EQUIPMENT_GROUP:"equipmentGroup",_PAINT_TYPE:"paintType",process:function(facet){if(facet&&facet.codes){
facet.codes.length&&facet.codes[0].codeType&&(facet.codeType=facet.codes[0].codeType);var newCode=[];angular.forEach(facet.codes,function(codeObj){newCode.push(codeObj.code)}),facet.code=newCode,delete facet.codes}},map:function(requestFacets,baseFacets){var mappedFacets=[];if(!requestFacets)return mappedFacets;for(var i=0;i<requestFacets.length;i++){var facetEntry={},key=requestFacets[i];for(var baseFacet in baseFacets)if(key===baseFacet){baseFacets[key].constructor===Array&&angular.forEach(baseFacets[key],function(facetObj){switch(key){case _FACETS._BGSCMAP:_FACETS.process(facetObj.bodyGroup),angular.forEach(facetObj.salesClass,_FACETS.process);break;case _FACETS._SCBGDRIVE:_FACETS.process(facetObj.salesClass),angular.forEach(facetObj.bodyGroup,_FACETS.process);break;default:_FACETS.process(facetObj)}}),facetEntry[key]=baseFacets[key];var masterDataResponse;if(baseFacet===_FACETS._FIRST_REG_DATE||baseFacet===_FACETS._FINAL_INSP_DATE){var minDate=facetEntry[key].min,maxDate=facetEntry[key].max;facetEntry[key].min=_CONVERTER.toFrontendDate(minDate),facetEntry[key].max=_CONVERTER.toFrontendDate(maxDate)}else if(baseFacet===_FACETS._EQUIPMENT_GROUP){var equipmentCategoriesToGroupCodeConfig=ConfigService.getInternalConfig(_CONFIG_EQUIPMENT_CAT_TO_GROUP_CODE);if(equipmentCategoriesToGroupCodeConfig){var equipmentCategoriesToGroupCode=JSON.parse(equipmentCategoriesToGroupCodeConfig);masterDataResponse=MasterDataService.getMDSync([_EQUIPMENT_CAT_MD_TYPE]);for(var equipmentCategoriesMasterData=masterDataResponse.results?masterDataResponse.results[_EQUIPMENT_CAT_MD_TYPE]:null,equipmentGroupFacets=facetEntry[key],j=0;j<equipmentGroupFacets.length;j++)updateEquipmentGroupFacetWithCategoryInfo(equipmentGroupFacets[j],equipmentCategoriesToGroupCode,equipmentCategoriesMasterData)}}else if(baseFacet===_FACETS._PAINT_TYPE&&EMULATE_PAINTTYPE_CODETEXT_FACET){masterDataResponse=MasterDataService.getMDSync([_PAINT_TYPE_KEY]);var paintTypeMasterData=masterDataResponse.results?masterDataResponse.results[_PAINT_TYPE_KEY]:null;UtilsService.convertTextFacetToCodeTextFacet(facetEntry[key],paintTypeMasterData)}mappedFacets.push(facetEntry)}}return mappedFacets}},_CRITERIA={_OFFER_PRICE_NET_UI:"offerPrice.net",_OFFER_PRICE_NET_BASE:"offerPriceNet",_OFFER_PRICE_GROSS_UI:"offerPrice.gross",_OFFER_PRICE_GROSS_BASE:"offerPriceGross",_NEW_PRICE_GROSS_UI:"newPrice.gross",_NEW_PRICE_GROSS_BASE:"newPriceGross",_NEW_PRICE_NET_UI:"newPrice.net",_NEW_PRICE_NET_BASE:"newPriceNet",_BODY_GROUP:"bodyGroup",_SALES_CLASS:"salesClass",process:function(criteria){var processedCriterion=[];return angular.forEach(criteria,function(criterion){if(criterion.codes)processedCriterion.push(criterion);else{var wrapper={codes:criterion};processedCriterion.push(wrapper)}}),processedCriterion},processMap:function(criterion,keyCriterion,valueCriterion){var processedMapCriterion=[];return angular.forEach(criterion,function(mapCriterion){var wrapper={codes:mapCriterion[keyCriterion]};mapCriterion[keyCriterion]=wrapper,mapCriterion[valueCriterion]=_CRITERIA.process(mapCriterion[valueCriterion]),processedMapCriterion.push(mapCriterion)}),processedMapCriterion},rename:function(criteria,oldName,newName){criteria&&criteria[oldName]&&(criteria[newName]=criteria[oldName],delete criteria[oldName])},renameSortable:function(sortCriterion){switch(sortCriterion.field){case _CRITERIA._OFFER_PRICE_NET_UI:sortCriterion.field=_CRITERIA._OFFER_PRICE_NET_BASE;break;case _CRITERIA._OFFER_PRICE_GROSS_UI:sortCriterion.field=_CRITERIA._OFFER_PRICE_GROSS_BASE;break;case _CRITERIA._NEW_PRICE_GROSS_UI:sortCriterion.field=_CRITERIA._NEW_PRICE_GROSS_BASE;break;case _CRITERIA._NEW_PRICE_NET_UI:sortCriterion.field=_CRITERIA._NEW_PRICE_NET_BASE}},convertToBackendRepr:function(criteria){if(criteria){var criteriaNames=Object.keys(criteria);angular.forEach(criteriaNames,function(name){var criterion=criteria[name];if(criterion&&criterion.constructor===Array&&_CODE_ARRAY_CRITERIA.indexOf(name)>-1)switch(name){case"bodyGroupSalesClassMap":criteria[name]=_CRITERIA.processMap(criterion,_CRITERIA._BODY_GROUP,_CRITERIA._SALES_CLASS);break;case"salesClassBodyGroupDrive":criteria[name]=_CRITERIA.processMap(criterion,_CRITERIA._SALES_CLASS,_CRITERIA._BODY_GROUP);break;default:criteria[name]=_CRITERIA.process(criterion)}}),_CONVERTER.toBackendMinMaxDate(criteria.inspectionEmission),_CONVERTER.toBackendMinMaxDate(criteria.inspectionTechnical),_CONVERTER.toBackendMinMaxDate(criteria.firstRegistrationDate,"firstRegistrationDate"),_CONVERTER.toBackendMinMaxDate(criteria.finalInspectionDate,"finalInspectionDate"),_CONVERTER.toBackendMinMaxDate(criteria.allocationPeriod,"allocationPeriod"),_CONVERTER.toBackendMinMaxDate(criteria.specificationDate,"specificationDate"),_CONVERTER.toBackendMinMaxDate(criteria.invoiceToDealerDate,"invoiceToDealerDate"),_CONVERTER.toBackendMinMaxDate(criteria.deliveryDate,"deliveryDate"),_CONVERTER.toBackendMinMaxDate(criteria.tradeInDate,"tradeInDate")}}},_REQUEST={setPaging:function(request){if(request&&request.searchInfo&&request.searchInfo.paging){var configPaging=ConfigService.getInternalConfig(_CONFIG_PAGING_MAX_VEHICLES),maxVehicles=parseInt(configPaging,10);request.searchInfo.paging.quantity=request.searchInfo.paging.vehiclesPerPage||maxVehicles||_DEFAULT_VEHICLES_PER_PAGE,request.searchInfo.paging.pageIndex=request.searchInfo.paging.currentPage-1,delete request.searchInfo.paging.vehiclesPerPage,delete request.searchInfo.paging.currentPage,delete request.searchInfo.paging.offset}},enrich:function(request,centralStock){var criteria=request.criteria,sortCriteria=request.searchInfo?request.searchInfo.sort:[],shouldRetrieveDealerHierarchy=ConfigService.getInternalConfig(_CONFIG_RETRIEVE_DEALER_HIERARCHY);delete request._version,request.searchInfo=request.searchInfo||{},request.searchInfo.centralStock=centralStock,angular.forEach(sortCriteria,_CRITERIA.renameSortable),_CRITERIA.rename(criteria,_CRITERIA._OFFER_PRICE_NET_UI,_CRITERIA._OFFER_PRICE_NET_BASE),_CRITERIA.rename(criteria,_CRITERIA._OFFER_PRICE_GROSS_UI,_CRITERIA._OFFER_PRICE_GROSS_BASE),_CRITERIA.rename(criteria,_CRITERIA._NEW_PRICE_NET_UI,_CRITERIA._NEW_PRICE_NET_BASE),_CRITERIA.rename(criteria,_CRITERIA._NEW_PRICE_GROSS_UI,_CRITERIA._NEW_PRICE_GROSS_BASE),_CRITERIA.convertToBackendRepr(criteria),criteria&&(_CRITERIA.convertToBackendRepr(criteria.should),_CRITERIA.convertToBackendRepr(criteria.mustNot),shouldRetrieveDealerHierarchy&&"false"!==shouldRetrieveDealerHierarchy||delete criteria.stockOwnership);var enrichedRequest={vehicleSearchRequest:request};return enrichedRequest}},_RESPONSE={buildInitFacetsResponse:function(response,request){var uiResponse={baseStatus:{},jsifStatus:{},context:{},token:"",_version:_VERSION,entities:{}};return response&&request&&(uiResponse.baseStatus=response.baseStatus?response.baseStatus:uiResponse.baseStatus,uiResponse.context=response.context?response.context:uiResponse.context,uiResponse.jsifStatus=response.jsifStatus?response.jsifStatus:uiResponse.jsifStatus,uiResponse.token=response.token?response.token:uiResponse.token,uiResponse.entities=request.entities?request.entities:uiResponse.entities,uiResponse._version=request._version?request._version:uiResponse._version),uiResponse},enrich:function(response,requestFacets,requestCriteria,requestCategories,requestSearchInfo){requestCategories?response.categories={}:requestCriteria&&(response.criteria=requestCriteria,requestSearchInfo&&(response.searchInfo=requestSearchInfo)),response.results&&(requestCategories?enrichCategoryResponse(response,requestFacets):requestCriteria?enrichCriteriaResponse(response,requestFacets,requestSearchInfo):requestFacets&&requestFacets.length&&enrichFacetsResponse(response,requestFacets)),response.suggest&&(response.synonyms=response.suggest.synonyms,response.results=response.suggest.match,delete response.suggest,delete response.vehicles,delete response.criteria,delete response.count,delete response.countText),(requestCriteria&&!requestCriteria.searchterm||requestCategories)&&delete response.results,response._version=response.version,delete response.version}};return{searchInitValues:function(initRequest){UtilsService.log("SEARCH INIT REQUEST:\n %s",initRequest);var facets=[];if(!initRequest||!initRequest.entities){var deferred=$q.defer(),response=_RESPONSE.buildInitFacetsResponse();return deferred.resolve(response),deferred.promise}for(var k in initRequest.entities)if(initRequest.entities.hasOwnProperty(k)){var entity=initRequest.entities[k];entity&&entity.forEach(function(facet){facets.indexOf(facet)<0&&facets.push(facet)})}return facets.sort(),VehSearchService.searchInitValues(facets).then(function(searchResponse){if(_RESPONSE.enrich(searchResponse,facets),searchResponse.facets&&searchResponse.facets.length)for(var k in initRequest.entities)if(initRequest.entities.hasOwnProperty(k)){var value=initRequest.entities[k],newEntities={};value&&value.forEach(function(f){searchResponse.facets.forEach(function(rf){var innerKeys=Object.keys(rf),facet=rf[innerKeys[0]];f===innerKeys[0]&&(newEntities[f]=facet)})}),initRequest.entities[k]=newEntities}var processedResponse=_RESPONSE.buildInitFacetsResponse(searchResponse,initRequest);return UtilsService.log("SEARCH INIT RESPONSE:\n %s",processedResponse),processedResponse})},searchVehicleDetail:function(searchRequest,centralStock){UtilsService.log("SEARCH VEHICLE DETAIL REQUEST:\n %s",searchRequest),_REQUEST.setPaging(searchRequest);var requestCriteria=angular.copy(searchRequest.criteria),requestFacets=searchRequest.facets,requestCategories=searchRequest.categories,requestSearchInfo=angular.copy(searchRequest.searchInfo);return searchRequest=_REQUEST.enrich(searchRequest,centralStock),VehSearchService.searchVehicleDetail(searchRequest).then(function(searchResponse){return _RESPONSE.enrich(searchResponse,requestFacets,requestCriteria,requestCategories,requestSearchInfo),UtilsService.log("SEARCH VEHICLE DETAIL RESPONSE:\n %s",searchResponse),searchResponse})},searchVehicleOverview:function(searchRequest,centralStock){UtilsService.log("SEARCH VEHICLE OVERVIEW REQUEST:\n %s",searchRequest),_REQUEST.setPaging(searchRequest);var requestCriteria=angular.copy(searchRequest.criteria),requestFacets=searchRequest.facets,requestCategories=searchRequest.categories,requestSearchInfo=angular.copy(searchRequest.searchInfo);return searchRequest=_REQUEST.enrich(searchRequest,centralStock),VehSearchService.searchVehicleOverview(searchRequest).then(function(searchResponse){return _RESPONSE.enrich(searchResponse,requestFacets,requestCriteria,requestCategories,requestSearchInfo),UtilsService.log("SEARCH VEHICLE OVERVIEW RESPONSE:\n %s",searchResponse),searchResponse})},searchVehicleCount:function(searchRequest,centralStock){UtilsService.log("SEARCH VEHICLE COUNT REQUEST:\n %s",searchRequest);var requestCriteria=angular.copy(searchRequest.criteria),requestFacets=searchRequest.facets,requestCategories=searchRequest.categories,requestSearchInfo=angular.copy(searchRequest.searchInfo);return searchRequest=_REQUEST.enrich(searchRequest,centralStock),VehSearchService.searchVehicleCount(searchRequest).then(function(searchResponse){return _RESPONSE.enrich(searchResponse,requestFacets,requestCriteria,requestCategories,requestSearchInfo),UtilsService.log("SEARCH VEHICLE COUNT RESPONSE:\n %s",searchResponse),searchResponse})},searchSuggest:function(searchRequest,centralStock){UtilsService.log("SEARCH VEHICLE SUGGEST REQUEST:\n %s",searchRequest);var requestCriteria=angular.copy(searchRequest.criteria),requestFacets=searchRequest.facets,requestCategories=searchRequest.categories,requestSearchInfo=angular.copy(searchRequest.searchInfo);return searchRequest=_REQUEST.enrich(searchRequest,centralStock),VehSearchService.searchSuggest(searchRequest).then(function(searchResponse){return _RESPONSE.enrich(searchResponse,requestFacets,requestCriteria,requestCategories,requestSearchInfo),UtilsService.log("SEARCH VEHICLE SUGGEST RESPONSE:\n %s",searchResponse),searchResponse})},searchGeoSuggest:function(searchRequest){UtilsService.log("SEARCH GEO SUGGEST REQUEST:\n %s",searchRequest);var maxSuggestions,requestCriteria=angular.copy(searchRequest.criteria),requestSearchInfo=angular.copy(searchRequest.searchInfo);return searchRequest.searchInfo&&(maxSuggestions=searchRequest.searchInfo.maxSuggestions),GeoSuggestService.getGeoSuggestions(searchRequest.criteria.searchterm,maxSuggestions).then(function(searchResponse){return _RESPONSE.enrich(searchResponse,null,requestCriteria,null,requestSearchInfo),UtilsService.log("SEARCH GEO SUGGEST RESPONSE:\n %s",searchResponse),searchResponse})},searchPropertySuggest:function(searchRequestParam){UtilsService.log("PROPERTY SUGGEST REQUEST:\n %s",searchRequestParam);var requestCriteria=angular.copy(searchRequestParam.criteria),searchRequest={PropertySuggestRequest:{criteria:searchRequestParam.criteria}};return PropSuggestService.searchPropSuggest(searchRequest).then(function(searchResponse){return searchResponse.searchInfo&&delete searchResponse.searchInfo,searchResponse.criteria=requestCriteria,UtilsService.log("PROPERTY SUGGEST RESPONSE:\n %s",searchRequest),searchResponse})},getBbdImages:function(vehicle,imageType,isNight){var vehicleImages=vehicle.getBbdImages(imageType,isNight);return vehicleImages},getTDVSData:function(fomVehicle){var tdvsData={values:[]};return fomVehicle?TDVSService.getTDVSData(fomVehicle.id):tdvsData},getTDVSDataAsync:function(fomVehicle){var tdvsData={values:[]};return fomVehicle?TDVSService.getTDVSDataAsync(fomVehicle.id).then(function(result){return tdvsData=result[0].parameters}):tdvsData},getMultipleTDVSDataAsync:function(fomVehicles){var tdvsData=[];if(!fomVehicles)return tdvsData;var ids=[];return angular.forEach(fomVehicles,function(fomVehicle){ids.push(fomVehicle.id)}),TDVSService.getMultipleTDVSDataAsync(ids).then(function(result){return angular.forEach(result,function(data){var vehicleTDVSData={},parameters=data.parameters;vehicleTDVSData.id=data.id,vehicleTDVSData.values=parameters?parameters.values:[],tdvsData.push(vehicleTDVSData)}),tdvsData})}}}]),angular.module("base.jsif").factory("UtilsService",["DEBUG",function(DEBUG){return{hashCode:function(input){var hash=0;if(!input||0===input.length)return hash;for(var i=0;i<input.length;i++){var c=input.charCodeAt(i);hash=(hash<<5)-hash+c,hash&=hash}return hash},convertToUTF8:function(buffer){for(var slice,CHUNK_SIZE=32768,ix=0,len=buffer?buffer.length:0,res="";ix<len;)slice=buffer.subarray(ix,Math.min(ix+CHUNK_SIZE,len)),res+=String.fromCharCode.apply(null,slice),ix+=CHUNK_SIZE;return decodeURIComponent(escape(res))},log:function(message,value){DEBUG&&console.log(message,JSON.stringify(value,null,4))},parseTimestamp:function(timestamp){var data=timestamp.split(" "),result={year:data.length>3?data[3]:""};return result},convertTextFacetToCodeTextFacet:function(textFacets,masterData){for(var i=0;i<textFacets.length;i++){var code=textFacets[i].text,text=masterData&&masterData[code]?masterData[code]:code;textFacets[i]={text:text,count:textFacets[i].count,codeType:"CODE_TYPE",code:[code]}}}}}]),angular.module("base.jsif").factory("ValidationService",["ConfigService",function(ConfigService){function validateCriteria(criteria){if(!criteria||!criteria.location||!criteria.location.postalCode)return{code:"200"};var validationStatus={},postalCode=criteria.location.postalCode.toString(),pattern=getConfiguredPostalCodePattern(),postalCodeRegex=new RegExp(pattern,"g");return!postalCodeRegex||pattern&&!postalCodeRegex.test(postalCode)?(validationStatus.code="503",validationStatus.message="The postal code does not match the pattern: /"+pattern+"/g."):validationStatus.code="200",validationStatus}function getConfiguredPostalCodePattern(){var pattern=ConfigService.getInternalConfig(POSTAL_CODE_PATTERN_CONFIG_KEY);return pattern&&(pattern="^"===pattern[0]?pattern:"^"+pattern,pattern="$"===pattern[pattern.length-1]?pattern:pattern+"$"),pattern}var POSTAL_CODE_PATTERN_CONFIG_KEY="postalCodePattern";return{validateCriteria:validateCriteria}}]),angular.module("base.jsif").factory("VehSearchService",["HttpService","ContextService","ConfigService","ValidationService","BASE_API_VEHICLESEARCH_URL",function(HttpService,ContextService,ConfigService,ValidationService,BASE_API_VEHICLESEARCH_URL){var lastBaseStatus={},performHTTPVehicleSearch=function(urlComponents,data){var dataHasVehicleSearchRequest=data&&data.vehicleSearchRequest;if(dataHasVehicleSearchRequest&&data.vehicleSearchRequest.criteria){var response=ValidationService.validateCriteria(data.vehicleSearchRequest.criteria);if(response&&"200"!==response.code)return HttpService.generateInvalidResponse(response)}var result;return result=urlComponents.endpoint?HttpService.get(urlComponents):HttpService.post(urlComponents,data)},performVehicleSearch=function(searchRequest,searchType,endpoint){var url=ConfigService.getBaseApiURL(BASE_API_VEHICLESEARCH_URL),requestUrl={resource:url,endpoint:endpoint,searchType:searchType},httpMethod=performHTTPVehicleSearch(requestUrl,searchRequest);return httpMethod.then(function(searchResponse){return lastBaseStatus=searchResponse.baseStatus,searchResponse})};return{searchVehicleDetail:function(searchRequest){var endpoint,criteria=searchRequest.vehicleSearchRequest.criteria,facets=searchRequest.vehicleSearchRequest.facets,context=ContextService.getContext(),hasBaseSession=context&&!(angular.isUndefined(context.sessionId)||""===context.sessionId);if(criteria&&angular.isObject(criteria)&&1===Object.keys(criteria).length&&criteria.id&&angular.isUndefined(facets)&&!hasBaseSession){var ids=criteria.id;angular.isArray(ids)&&1===ids.length?endpoint=ids[0]:angular.isArray(ids)||(endpoint=ids)}var httpMethod=performVehicleSearch(searchRequest,"detail",endpoint);return httpMethod},searchVehicleOverview:function(searchRequest){var httpMethod=performVehicleSearch(searchRequest,"overview");return httpMethod},searchVehicleCount:function(searchRequest){var httpMethod=performVehicleSearch(searchRequest,"count");return httpMethod},searchSuggest:function(searchRequest){delete searchRequest.facets;var httpMethod=performVehicleSearch(searchRequest,"suggest");return httpMethod},searchInitValues:function(initRequest){var searchRequest={vehicleSearchRequest:{facets:initRequest}},httpMethod=performVehicleSearch(searchRequest,"init");return httpMethod},getLastBaseStatus:function(){return lastBaseStatus}}}]),angular.module("base.jsif").factory("VehicleMasterDataService",["HttpService","ContextService","ConfigService","BASE_API_VMD_URL",function(HttpService,ContextService,ConfigService,BASE_API_VMD_URL){function createVehicleMatserDataRequest(context){context.locale=context.language+"_"+context.countryCode;var result={};return result.VehicleMDRequest={context:context,masterdata:{vmdType:mdTypesRequest}},result}function createArrayVmdTypesForRequest(){for(var requestMDTypes=[],index=0;index<EXPECTED_VEHICLE_MD_TYPES.length;index++){var mdTypeRequest={type:EXPECTED_VEHICLE_MD_TYPES[index],vehicleCategory:"PASSENGER"};requestMDTypes.push(mdTypeRequest)}return requestMDTypes}var EXPECTED_VEHICLE_MD_TYPES=["BODY_GROUP","MANU_GRP","EMISSION","EQUIPMENT_GROUP","FUEL_TYPE","CURRENT_SALES_MODEL","LINE","OPERATION_TYPE","PAINT_GROUP","STEERING","TRANSMISSION_TYPE","UPHOLSTERY"],mdTypesRequest=createArrayVmdTypesForRequest();return{getVehicleMasterData:function(){var context=ContextService.getContext(),host=ConfigService.getBaseApiURL(BASE_API_VMD_URL),url=host+"/fetch",request=createVehicleMatserDataRequest(context),httpMethod=HttpService.post({resource:url},request);return httpMethod.then(function(response){var vmdResponse=[];return response&&response.vehicleMDResponse&&response.vehicleMDResponse.masterdata&&response.vehicleMDResponse.masterdata.vmdType&&(vmdResponse=response.vehicleMDResponse.masterdata.vmdType),vmdResponse})},getSuggestVehicleMasterData:function(mdType,term){var context=ContextService.getContext();context.locale=context.language+"_"+context.countryCode;var host=ConfigService.getBaseApiURL(BASE_API_VMD_URL),url=host+"/fetch",request={};request.VehicleMDRequest={context:context,masterdata:{vmdType:[{type:mdType,vehicleCategory:"PASSENGER",term:term}]}};var httpMethod=HttpService.post({resource:url},request);return httpMethod.then(function(response){var vmdResponse=[];return response&&response.vehicleMDResponse&&response.vehicleMDResponse.masterdata&&response.vehicleMDResponse.masterdata.vmdType&&(vmdResponse=response.vehicleMDResponse.masterdata.vmdType),vmdResponse})},getVehicleMasterDataWithGroupCode:function(mdType,groupCode){var context=ContextService.getContext();context.locale=context.language+"_"+context.countryCode;var host=ConfigService.getBaseApiURL(BASE_API_VMD_URL),url=host+"/fetch",request={};request.VehicleMDRequest={context:context,masterdata:{vmdType:[{type:mdType,vehicleCategory:"PASSENGER",groupCode:groupCode}]}};var httpMethod=HttpService.post({resource:url},request);return httpMethod.then(function(response){var vmdResponse=[];return response&&response.vehicleMDResponse&&response.vehicleMDResponse.masterdata&&response.vehicleMDResponse.masterdata.vmdType&&(vmdResponse=response.vehicleMDResponse.masterdata.vmdType),vmdResponse})}}}]);
//# sourceMappingURL=jsif.js.map